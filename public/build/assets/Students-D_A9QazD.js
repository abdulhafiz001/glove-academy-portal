import{u as ve,a as we,r as l,A as j,j as e,X as Ce,b as Oe,C as M,d as se,f as Q}from"./app-17JNjqSJ.js";import{T as ge,D as Pe}from"./DeleteConfirmationModal-CEIO2WhT.js";import{U as fe}from"./user-CAmUnVMn.js";import{M as Se}from"./mail-Bgl57yVY.js";import{G as _e}from"./graduation-cap-mrkAgQ1z.js";import{S as Ue}from"./save-CvmKl75M.js";import{A as Ie,U as Re}from"./AdminLayout-DXkI0PI6.js";import{S as Ge}from"./shield-Dhn-V6E4.js";import{D as pe}from"./download-7IDGFHuP.js";import{U as qe}from"./upload-f9lC6ujl.js";import{U as O}from"./users-BUbPeWYP.js";import{B as be}from"./book-open-D3qBa7nK.js";import{S as Ve}from"./search-Dk6ZNiIw.js";import{F as Ye}from"./funnel-Be2HiVOE.js";import{F as ye}from"./file-text-Znh3F_nC.js";import{S as je}from"./square-pen-Bg_diimZ.js";import{U as Ne,M as Be}from"./user-check-Bk_b1vVU.js";import{P as ze}from"./phone-CsahMqDW.js";import{C as He}from"./calendar-BfCctGZ3.js";import"./log-out-Bc-nJCmd.js";import"./menu-BL5-W5Xp.js";const Je=({isOpen:v,onClose:E,student:i,onSuccess:A})=>{var b;const{showError:t,showSuccess:W}=ve(),{user:d}=we(),[c,w]=l.useState({}),[D,p]=l.useState([]),[P,u]=l.useState([]),[Y,B]=l.useState(!1),[U,I]=l.useState(!1),[Z,C]=l.useState(!1);l.useEffect(()=>{var r,o;v&&i?(w({first_name:i.first_name||"",last_name:i.last_name||"",middle_name:i.middle_name||"",admission_number:i.admission_number||"",email:i.email||"",phone:i.phone||"",date_of_birth:i.date_of_birth?new Date(i.date_of_birth).toISOString().split("T")[0]:"",gender:i.gender||"",address:i.address||"",parent_name:i.parent_name||"",parent_phone:i.parent_phone||"",parent_email:i.parent_email||"",class_id:((r=i.class_id)==null?void 0:r.toString())||"",subjects:((o=i.student_subjects)==null?void 0:o.map(g=>{var m;return(m=g.subject)==null?void 0:m.name}))||[],is_active:i.is_active!==void 0?i.is_active:!0}),u([]),p([]),z(),S()):v||(w({}),u([]),p([]),C(!1))},[v,i]);const z=async()=>{try{let r;(d==null?void 0:d.role)==="teacher"?r=await j.getTeacherClasses():r=await j.getClasses();let o=[];r&&r.data&&(Array.isArray(r.data)?o=r.data:r.data.data&&Array.isArray(r.data.data)&&(o=r.data.data)),p(o)}catch(r){console.error("Error fetching classes:",r),p([])}},S=async()=>{try{C(!0);let r;(d==null?void 0:d.role)==="teacher"?r=await j.getAllSubjects():r=await j.getSubjects();let o=[];r&&r.data&&(Array.isArray(r.data)?o=r.data:r.data.data&&Array.isArray(r.data.data)&&(o=r.data.data)),u(o)}catch(r){console.error("Error fetching subjects:",r),u([])}finally{C(!1)}},x=r=>{const{name:o,value:g,type:m,checked:G}=r.target;w(H=>({...H,[o]:m==="checkbox"?G:g}))},h=r=>{w(o=>({...o,subjects:(o.subjects||[]).includes(r)?(o.subjects||[]).filter(g=>g!==r):[...o.subjects||[],r]}))},R=async r=>{var o,g;r.preventDefault(),I(!0);try{let m;(d==null?void 0:d.role)==="teacher"?m=await j.updateTeacherStudent(i.id,c):m=await j.updateStudent(i.id,c),W("Student updated successfully"),A(m.data.student),E()}catch(m){t(((g=(o=m.response)==null?void 0:o.data)==null?void 0:g.message)||"Failed to update student"),console.error("Error updating student:",m)}finally{I(!1)}};return v?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-10 mx-auto p-6 border w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3 shadow-xl rounded-lg bg-white max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Edit Student"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Update student information and academic details"})]}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Ce,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:R,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(fe,{className:"mr-3 h-5 w-5 text-blue-600"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",name:"first_name",value:c.first_name||"",onChange:x,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",name:"last_name",value:c.last_name||"",onChange:x,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter last name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Middle Name"}),e.jsx("input",{type:"text",name:"middle_name",value:c.middle_name||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"Enter middle name"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admission Number *"}),e.jsx("input",{type:"text",name:"admission_number",value:c.admission_number||"",onChange:x,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",placeholder:"e.g., ADM/2024/001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender"}),e.jsxs("select",{name:"gender",value:c.gender||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"date_of_birth",value:c.date_of_birth||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-100",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(Se,{className:"mr-3 h-5 w-5 text-green-600"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:c.email||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"student@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:c.phone||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"+234 xxx xxx xxxx"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),e.jsx("textarea",{name:"address",value:c.address||"",onChange:x,rows:"3",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",placeholder:"Enter full address"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-100",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(fe,{className:"mr-3 h-5 w-5 text-purple-600"}),"Parent/Guardian Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parent Name"}),e.jsx("input",{type:"text",name:"parent_name",value:c.parent_name||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"Enter parent/guardian name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parent Phone"}),e.jsx("input",{type:"tel",name:"parent_phone",value:c.parent_phone||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"+234 xxx xxx xxxx"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parent Email"}),e.jsx("input",{type:"email",name:"parent_email",value:c.parent_email||"",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",placeholder:"parent@email.com"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-100",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(_e,{className:"mr-3 h-5 w-5 text-yellow-600"}),"Academic Information"]}),(d==null?void 0:d.role)==="teacher"&&D.length===0&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(Oe,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Limited Access"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsx("p",{children:"You can only edit students from classes where you are the form teacher."})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Class *",(d==null?void 0:d.role)==="teacher"&&e.jsx("span",{className:"text-xs text-blue-600 ml-2",children:"(Your assigned classes only)"})]}),e.jsxs("select",{name:"class_id",value:c.class_id||"",onChange:x,required:!0,disabled:Y||(d==null?void 0:d.role)==="teacher"&&D.length===0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all disabled:opacity-50",children:[e.jsx("option",{value:"",children:Y?"Loading classes...":D.length===0?"No classes available":"Select Class"}),D.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{name:"is_active",value:((b=c.is_active)==null?void 0:b.toString())||"true",onChange:x,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Subjects"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:Z?e.jsx("div",{className:"col-span-full text-center py-4 text-gray-500",children:"Loading subjects..."}):!P||P.length===0?e.jsx("div",{className:"col-span-full text-center py-4 text-gray-500",children:"No subjects available"}):P.map((r,o)=>{var g;return e.jsxs("label",{className:"flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-yellow-300 transition-colors cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:((g=c.subjects)==null?void 0:g.includes(r.name))||!1,onChange:()=>h(r.name),className:"h-4 w-4 rounded border-gray-300 focus:ring-2 focus:ring-yellow-500 text-yellow-600"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:r.name})]},`${r.id}-${o}`)})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:E,className:"px-6 py-3 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-all duration-200 hover:shadow-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:U,className:"px-6 py-3 border border-transparent text-sm font-medium rounded-lg text-white shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105",style:{backgroundColor:M.primary.red},children:U?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving Changes..."]}):e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})]})]})}):null},fs=({students:v,classes:E})=>{const{showError:i,showSuccess:A}=ve(),{user:t,refreshUserData:W}=we(),[d,c]=l.useState(null),w=l.useRef(!1),D=l.useRef(null),[p,P]=l.useState("all"),[u,Y]=l.useState(""),[B,U]=l.useState("grid"),[I,Z]=l.useState(!1),[C,z]=l.useState(""),[S,x]=l.useState(""),[h,R]=l.useState(()=>Array.isArray(v)?v:[]),[b,r]=l.useState(()=>{if(E&&Array.isArray(E)){const s=a=>{const n=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-yellow-100 text-yellow-800","bg-purple-100 text-purple-800","bg-red-100 text-red-800","bg-indigo-100 text-indigo-800","bg-pink-100 text-pink-800","bg-orange-100 text-orange-800"],f=a.length%n.length;return n[f]};return[{id:"all",name:"All Classes",count:0,color:"bg-gray-100 text-gray-800"},...E.map(a=>({id:a.id,name:a.name,count:0,color:s(a.name)}))]}return[]}),[o,g]=l.useState(!1),[m,G]=l.useState({isOpen:!1,student:null}),[H,te]=l.useState({isOpen:!1,student:null}),[ke,ae]=l.useState(!1),[_,L]=l.useState({isOpen:!1,importing:!1,selectedClassId:null}),[q,re]=l.useState(null),k=l.useMemo(()=>(t==null?void 0:t.role)==="admin",[t==null?void 0:t.role]),T=l.useMemo(()=>(t==null?void 0:t.role)==="teacher",[t==null?void 0:t.role]),V=d!==null?d:(t==null?void 0:t.is_form_teacher)===!0||(t==null?void 0:t.is_form_teacher)===1,J=l.useMemo(()=>T&&V,[T,V]),Ae=l.useMemo(()=>k||J,[k,J]),Me=l.useMemo(()=>k||J,[k,J]),Fe=()=>(t==null?void 0:t.role)==="admin"?"Manage all students in the school":(t==null?void 0:t.role)==="teacher"&&(t!=null&&t.is_form_teacher)?"Manage students in your assigned classes and view students in classes you teach":(t==null?void 0:t.role)==="teacher"?"View students in classes where you teach subjects (read-only access)":"Student Management",ee=l.useRef(!1);l.useEffect(()=>{t!=null&&t.id&&t.id!==D.current&&(w.current=!1,ee.current=!1,D.current=t.id),t!=null&&t.id&&!w.current&&t.role==="teacher"?(w.current=!0,W().then(s=>{s&&c(s.is_form_teacher)}).catch(s=>{w.current=!1})):t!=null&&t.id&&!w.current&&(w.current=!0)},[t==null?void 0:t.id]),l.useEffect(()=>{ee.current||(ee.current=!0,g(!1))},[]),l.useEffect(()=>{h.length>0&&b.length>0&&(b.some(a=>a.count!==void 0&&a.count!==0)||Ee())},[h,b]);const le=async()=>{try{g(!0);const s=(t==null?void 0:t.role)==="teacher"?await j.getTeacherStudents():await j.getStudents();let a;if((t==null?void 0:t.role)==="teacher"){const n=s.data||s;if(n!=null&&n.students){if(a=n.students,n.is_form_teacher!==void 0&&t){c(n.is_form_teacher);const f={...t,is_form_teacher:n.is_form_teacher};localStorage.setItem("user",JSON.stringify(f))}}else a=[]}else Array.isArray(s)?a=s:s!=null&&s.data&&Array.isArray(s.data)?a=s.data:a=[];se.component("Students","fetchStudents - Data loaded",{count:(a==null?void 0:a.length)||0,isArray:Array.isArray(a)}),R(Array.isArray(a)?a:[])}catch{i("Failed to load students"),R([])}finally{g(!1)}},Ee=l.useCallback(()=>{r(s=>s.map(a=>({...a,count:a.id==="all"?h.length:h.filter(n=>{var f;return((f=n.class_id)==null?void 0:f.toString())===a.id.toString()}).length})))},[h]),X=l.useMemo(()=>{if(!Array.isArray(h)||h.length===0)return[];const s=h.filter(a=>{var y,F,ce,me,xe,ue,he;const n=p==="all"||((y=a.class_id)==null?void 0:y.toString())===(p==null?void 0:p.toString()),f=!S||S===""||((F=a.class_id)==null?void 0:F.toString())===(S==null?void 0:S.toString()),$=!C||C===""||((ce=a.gender)==null?void 0:ce.toLowerCase())===C.toLowerCase(),N=!u||u===""||((me=a.first_name)==null?void 0:me.toLowerCase().includes(u.toLowerCase()))||((xe=a.last_name)==null?void 0:xe.toLowerCase().includes(u.toLowerCase()))||((ue=a.admission_number)==null?void 0:ue.toLowerCase().includes(u.toLowerCase()))||((he=a.email)==null?void 0:he.toLowerCase().includes(u.toLowerCase()));return n&&f&&$&&N});return se.component("Students","Filtering students",{selectedClass:p,filterClass:S,filterGender:C,searchTermLength:(u==null?void 0:u.length)||0,totalStudents:h.length,filteredCount:s.length}),s},[p,S,C,u,h]),De=l.useCallback(async()=>{if(m.student){ae(!0);try{(t==null?void 0:t.role)==="teacher"?await j.deleteStudent(m.student.id):await j.deleteStudent(m.student.id),A("Student deleted successfully"),G({isOpen:!1,student:null}),le()}catch{i("Failed to delete student")}finally{ae(!1)}}},[m.student,A,i,t==null?void 0:t.role]),ne=l.useCallback(s=>{te({isOpen:!0,student:s})},[]),Le=l.useCallback(s=>{R(a=>a.map(n=>n.id===s.id?s:n)),A("Student updated successfully")},[A]),ie=l.useCallback(s=>{if((t==null?void 0:t.role)==="teacher"&&!s.can_manage){i("You can only delete students from classes where you are the form teacher");return}G({isOpen:!0,student:s})},[t==null?void 0:t.role,i]),Te=l.useCallback(()=>{G({isOpen:!1,student:null})},[]),$e=l.useCallback(()=>{te({isOpen:!1,student:null})},[]),K=l.useCallback(s=>{(t==null?void 0:t.role)==="admin"?Q.visit(`/admin/students/${s.id}/details`):(t==null?void 0:t.role)==="teacher"&&V?Q.visit(`/teacher/students/${s.id}/details`):i("Access denied. Only form teachers can view student details.")},[Q,t,V,i]),oe=l.useCallback(s=>{const a=b.find(n=>n.name===s);return a?a.color:"bg-gray-100 text-gray-800"},[b]),de=l.useCallback(s=>!!(k||T&&s.can_manage),[k,T]);return o&&(!v||v.length===0)?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:M.primary.red}})}):!t&&(!v||v.length===0)?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:M.primary.red}})}):e.jsx(Ie,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl",children:"Students Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:Fe()}),T&&e.jsxs("div",{className:"mt-2 flex items-center text-sm text-blue-600",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),V?"You have form teacher permissions for some classes":"You can view students but cannot manage them"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 w-full sm:w-auto",children:[Me&&t&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:async()=>{try{await j.exportStudents(),A("Students exported successfully")}catch(s){i(s.message||"Failed to export students")}},className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsxs("button",{onClick:()=>L({isOpen:!0,importing:!1,selectedClassId:null}),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Import"]})]}),Ae&&t&&e.jsxs("button",{onClick:()=>Q.visit("/admin/add-student"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:M.primary.red},children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Add Student"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(O,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(O,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h.filter(s=>s.is_active).length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(_e,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Classes"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:b.length-1})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(be,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Filtered"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:X.length})]})]})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 px-6 overflow-x-auto",children:b.map(s=>e.jsxs("button",{onClick:()=>{se.component("Students","Class tab clicked",{classId:s.id,className:s.name}),P(s.id)},className:`
                  group inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap
                  ${p===s.id?"border-red-500 text-red-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,style:p===s.id?{borderColor:M.primary.red,color:M.primary.red}:{},children:[e.jsx(O,{className:"mr-2 h-5 w-5"}),s.name,e.jsx("span",{className:`ml-2 py-0.5 px-2.5 rounded-full text-xs ${s.color}`,children:s.count})]},s.id))})}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search students by name, admission number, or email...",value:u,onChange:s=>Y(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":M.primary.red}})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>Z(!I),className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),"Filters"]}),e.jsxs("div",{className:"flex border border-gray-300 rounded-md",children:[e.jsx("button",{onClick:()=>U("grid"),className:`px-3 py-2 text-sm font-medium ${B==="grid"?"bg-gray-100 text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:"Grid"}),e.jsx("button",{onClick:()=>U("table"),className:`px-3 py-2 text-sm font-medium ${B==="table"?"bg-gray-100 text-gray-900":"text-gray-500 hover:text-gray-700"}`,children:"Table"})]})]})]}),I&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("select",{value:C,onChange:s=>z(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":M.primary.red},children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),e.jsxs("select",{value:S,onChange:s=>x(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":M.primary.red},children:[e.jsx("option",{value:"",children:"All Classes"}),b.filter(s=>s.id!=="all").map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:()=>{z(""),x("")},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md text-sm hover:bg-gray-200",children:"Clear Filters"})]})})]}),e.jsxs("div",{className:"p-6",children:[B==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map(s=>{var a,n,f,$,N;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>K(s),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0",children:s.avatar?e.jsx("img",{src:s.avatar,alt:`${s.first_name} ${s.last_name}`,className:"w-full h-full rounded-full object-cover"}):e.jsx(O,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:[s.first_name," ",s.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.admission_number})]})]}),e.jsxs("div",{className:"flex space-x-1 flex-shrink-0",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),K(s)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"View Results",children:e.jsx(ye,{className:"h-4 w-4"})}),de(s)&&e.jsx("button",{onClick:y=>{y.stopPropagation(),ne(s)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",title:"Edit Student",children:e.jsx(je,{className:"h-4 w-4"})}),k&&e.jsx("button",{onClick:y=>{y.stopPropagation(),ie(s)},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete student",children:e.jsx(ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${oe((a=s.school_class)==null?void 0:a.name)}`,children:((n=s.school_class)==null?void 0:n.name)||"No Class"}),s.is_form_teacher&&e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-50 text-green-700",children:[e.jsx(Ne,{className:"mr-1 h-3 w-3"}),"Form Teacher"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),s.email||"No email"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),s.phone||"No phone"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),s.date_of_birth||"No DOB"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),s.address||"No address"]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Subjects (",((f=s.student_subjects)==null?void 0:f.length)||0,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[($=s.student_subjects)==null?void 0:$.slice(0,3).map(y=>{var F;return e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-50 text-blue-700",children:(F=y.subject)==null?void 0:F.name},y.id)}),((N=s.student_subjects)==null?void 0:N.length)>3&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-600",children:["+",s.student_subjects.length-3," more"]})]})]})]})},`student-${s.id}`)})}):e.jsx("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subjects"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.map(s=>{var a,n,f,$;return e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>K(s),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center mr-3 flex-shrink-0",children:s.avatar?e.jsx("img",{src:s.avatar,alt:`${s.first_name} ${s.last_name}`,className:"w-full h-full rounded-full object-cover"}):e.jsx(O,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 truncate",children:[s.first_name," ",s.last_name]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.admission_number})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${oe((a=s.school_class)==null?void 0:a.name)}`,children:((n=s.school_class)==null?void 0:n.name)||"No Class"}),s.is_form_teacher&&e.jsxs("span",{className:"mt-1 inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-50 text-green-700",children:[e.jsx(Ne,{className:"mr-1 h-3 w-3"}),"Form Teacher"]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.email||"No email"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone||"No phone"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(f=s.student_subjects)==null?void 0:f.slice(0,2).map((N,y)=>{var F;return e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-50 text-blue-700",children:(F=N.subject)==null?void 0:F.name},`${s.id}-subject-${y}`)}),(($=s.student_subjects)==null?void 0:$.length)>2&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-600",children:["+",s.student_subjects.length-2," more"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:N=>{N.stopPropagation(),K(s)},className:"text-blue-600 hover:text-blue-900 transition-colors",title:"View Results",children:e.jsx(ye,{className:"h-4 w-4"})}),de(s)&&e.jsx("button",{onClick:N=>{N.stopPropagation(),ne(s)},className:"text-indigo-600 hover:text-indigo-900 transition-colors",title:"Edit Student",children:e.jsx(je,{className:"h-4 w-4"})}),k&&e.jsx("button",{onClick:N=>{N.stopPropagation(),ie(s)},className:"text-red-600 hover:text-red-900 transition-colors",title:"Delete student",children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},`student-row-${s.id}`)})})]})}),X.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:T&&h.length===0?"No students offering your assigned subjects yet":"No students found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:T&&h.length===0?"Students will appear here once they are enrolled in subjects you teach.":"Try adjusting your search or filter criteria."})]})]})]}),e.jsx(Pe,{isOpen:m.isOpen,onClose:Te,onConfirm:De,title:"Delete Student",message:"Are you sure you want to delete this student? This action cannot be undone and will remove all associated data including scores and records.",itemName:m.student?`${m.student.first_name} ${m.student.last_name}`:"",isLoading:ke}),e.jsx(Je,{isOpen:H.isOpen,onClose:$e,student:H.student,onSuccess:Le}),_.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",children:e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Students from Excel/CSV"}),e.jsx("button",{onClick:()=>L({isOpen:!1,importing:!1,selectedClassId:null}),className:"text-gray-400 hover:text-gray-600",children:e.jsx(Ce,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Upload an Excel (.xlsx, .xls) or CSV file containing student data. Download the template below to see the required format."}),e.jsxs("button",{onClick:async()=>{var s,a;try{await j.downloadStudentTemplate(),A("Template downloaded")}catch(n){i(((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||n.message||"Failed to download template")}},className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Download Template"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Class ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:_.selectedClassId||"",onChange:s=>L({..._,selectedClassId:s.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",required:!0,children:[e.jsx("option",{value:"",children:"-- Select a class --"}),k?b.filter(s=>s.id!=="all").map(s=>e.jsx("option",{value:s.id,children:s.name},s.id)):b.filter(s=>s.id!=="all"&&s.is_form_teacher!==!1).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:k?"Select the class where you want to import students.":"You can only import students to classes where you are a form teacher."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select File ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:async s=>{const a=s.target.files[0];if(a){if(!_.selectedClassId){i("Please select a class first");return}L({..._,importing:!0});try{const n=await j.importStudents(a,_.selectedClassId);re(n),A(`Import completed: ${n.success_count} successful, ${n.error_count} errors`),le(),L({isOpen:!1,importing:!1,selectedClassId:null})}catch(n){i(n.message||"Failed to import students")}finally{L({..._,importing:!1})}}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:_.importing||!_.selectedClassId})]}),q&&e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"mb-2",children:e.jsxs("span",{className:"font-medium text-green-600",children:["Successfully imported: ",q.success_count," students"]})}),q.error_count>0&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium text-red-600",children:["Errors: ",q.error_count]}),e.jsx("div",{className:"mt-2 max-h-32 overflow-y-auto",children:q.errors.map((s,a)=>e.jsxs("div",{className:"text-xs text-red-600 mb-1",children:["Row ",s.row," (",s.admission_number,"): ",s.errors.join(", ")]},a))})]})]})}),_.importing&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Importing..."})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:()=>{L({isOpen:!1,importing:!1}),re(null)},className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Close"})})]})})})]})})};export{fs as default};
