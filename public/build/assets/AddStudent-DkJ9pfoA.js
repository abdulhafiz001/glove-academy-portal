import{r as p,u as _,a as B,d as y,A as g,j as e,C as l,b as L}from"./app-17JNjqSJ.js";import{A as I}from"./AdminLayout-DXkI0PI6.js";import{U as R}from"./user-CAmUnVMn.js";import{M as q}from"./mail-Bgl57yVY.js";import{B as M}from"./book-open-D3qBa7nK.js";import{S as T}from"./save-CvmKl75M.js";import"./users-BUbPeWYP.js";import"./file-text-Znh3F_nC.js";import"./calendar-BfCctGZ3.js";import"./log-out-Bc-nJCmd.js";import"./menu-BL5-W5Xp.js";const Z=({classes:b=[],subjects:A=[]})=>{const[s,j]=p.useState({firstName:"",lastName:"",middleName:"",admissionNumber:"",email:"",phone:"",dateOfBirth:"",gender:"",address:"",parentName:"",parentPhone:"",parentEmail:"",class:"",subjects:[]}),[S,k]=p.useState(!1),[o,N]=p.useState(b||[]),[C,P]=p.useState(A||[]),[f,w]=p.useState(!1),{showError:v,showSuccess:E}=_(),{user:a}=B();p.useEffect(()=>{b&&b.length>0?(N(b),w(!1)):a!=null&&a.id&&F()},[a==null?void 0:a.id,b,A]);const F=async()=>{var t,n,c;try{w(!0),y.component("AddStudent","fetchFormData - Starting",{userRole:a==null?void 0:a.role});const[r,d]=await Promise.all([(a==null?void 0:a.role)==="teacher"?g.getFormTeacherClasses():g.getClasses(),(a==null?void 0:a.role)==="teacher"?g.getTeacherSubjects():g.getSubjects()]);y.component("AddStudent","fetchFormData - API responses received",{classesData:r?"received":"null",subjectsData:d?"received":"null"});let m=null;(t=r==null?void 0:r.data)!=null&&t.data&&Array.isArray(r.data.data)?m=r.data.data:r!=null&&r.data&&Array.isArray(r.data)?m=r.data:Array.isArray(r)&&(m=r);let h=null;d!=null&&d.data&&Array.isArray(d.data)?h=d.data:Array.isArray(d)&&(h=d);const x=Array.isArray(m)?m:[],u=Array.isArray(h)?h:[];y.component("AddStudent","fetchFormData - Data processed",{classesCount:x.length,subjectsCount:u.length}),N(x),P(u),(a==null?void 0:a.role)==="teacher"&&x.length===0&&v("You are not assigned as a form teacher to any class. Please contact the administrator.")}catch(r){v(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to load form data. Please try again."),N([]),P([])}finally{w(!1)}},i=t=>{const{name:n,value:c}=t.target;j(r=>({...r,[n]:c}))},D=t=>{j(n=>({...n,subjects:n.subjects.includes(t)?n.subjects.filter(c=>c!==t):[...n.subjects,t]}))},O=async t=>{var n,c;t.preventDefault(),k(!0);try{const r=o.find(u=>u.name===s.class);if(!r)throw new Error("Please select a valid class");const d=C.filter(u=>s.subjects.includes(u.name)).map(u=>u.id);if(d.length===0)throw new Error("Please select at least one subject");const m={first_name:s.firstName,last_name:s.lastName,middle_name:s.middleName,admission_number:s.admissionNumber,email:s.email,phone:s.phone,date_of_birth:s.dateOfBirth,gender:s.gender,address:s.address,parent_name:s.parentName,parent_phone:s.parentPhone,parent_email:s.parentEmail,class_id:r.id,subjects:d},h=window.location.pathname.includes("/teacher/add-student"),x=(a==null?void 0:a.role)==="teacher"||h;y.component("AddStudent","Submitting student data",{userRole:a==null?void 0:a.role,currentPath:window.location.pathname,isTeacherRoute:h,isTeacher:x,endpoint:x?"/teacher/students":"/admin/students",userObject:a}),x?await g.addStudent(m):await g.createStudent(m),E("Student added successfully! They can now login with their admission number."),j({firstName:"",lastName:"",middleName:"",admissionNumber:"",email:"",phone:"",dateOfBirth:"",gender:"",address:"",parentName:"",parentPhone:"",parentEmail:"",class:"",subjects:[]})}catch(r){v(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Please fill in all required fields and try again.")}finally{k(!1)}};return e.jsx(I,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl",children:"Add New Student"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Fill in the student's information to add them to the system.",(a==null?void 0:a.role)==="teacher"&&e.jsx("span",{className:"block mt-1 text-blue-600",children:"As a form teacher, you can only add students to classes you are assigned to."})]})]}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsxs("form",{onSubmit:O,className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(R,{className:"mr-2 h-5 w-5",style:{color:l.primary.red}}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",name:"firstName",value:s.firstName,onChange:i,required:!0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"Enter first name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",name:"lastName",value:s.lastName,onChange:i,required:!0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"Enter last name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Middle Name"}),e.jsx("input",{type:"text",name:"middleName",value:s.middleName,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"Enter middle name"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admission Number *"}),e.jsx("input",{type:"text",name:"admissionNumber",value:s.admissionNumber,onChange:i,required:!0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"e.g., ADM/2024/001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"dateOfBirth",value:s.dateOfBirth,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gender"}),e.jsxs("select",{name:"gender",value:s.gender,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(q,{className:"mr-2 h-5 w-5",style:{color:l.primary.blue}}),"Contact Information (Optional)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:s.email,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"student@email.com (optional)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"+234 xxx xxx xxxx (optional)"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx("textarea",{name:"address",value:s.address,onChange:i,rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":l.primary.red},placeholder:"Enter full address (optional)"})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(M,{className:"mr-2 h-5 w-5",style:{color:l.primary.yellow}}),"Academic Information"]}),(a==null?void 0:a.role)==="teacher"&&Array.isArray(o)&&o.length===0&&!f&&e.jsx("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(L,{className:"h-5 w-5 text-yellow-400"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"No Classes Available"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsx("p",{children:"You are not assigned as a form teacher to any class. Please contact the administrator to be assigned as a form teacher before adding students."})})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Class *",(a==null?void 0:a.role)==="teacher"&&e.jsx("span",{className:"text-xs text-blue-600 ml-1",children:"(Your assigned classes only)"})]}),e.jsxs("select",{name:"class",value:s.class,onChange:i,required:!0,disabled:f||(a==null?void 0:a.role)==="teacher"&&Array.isArray(o)&&o.length===0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent disabled:opacity-50",style:{"--tw-ring-color":l.primary.red},children:[e.jsx("option",{value:"",children:f?"Loading classes...":Array.isArray(o)&&o.length===0?"No classes available":"Select class"}),Array.isArray(o)&&o.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subjects"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:f?e.jsx("div",{className:"col-span-full text-center py-4 text-gray-500",children:"Loading subjects..."}):C.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:s.subjects.includes(t.name),onChange:()=>D(t.name),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":l.primary.red}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t.name})]},t.id))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2",style:{"--tw-ring-color":l.primary.red},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:S||(a==null?void 0:a.role)==="teacher"&&Array.isArray(o)&&o.length===0,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:l.primary.red,"--tw-ring-color":l.primary.red},children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding Student..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Add Student"]})})]})]})})]})})};export{Z as default};
