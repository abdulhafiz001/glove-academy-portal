import{r as d,j as e,X as fe,u as ne,A as v,I as we,C as u,T as Ce,g as ve,d as H}from"./app-17JNjqSJ.js";import{T as re,D as oe}from"./DeleteConfirmationModal-CEIO2WhT.js";import{S as le}from"./save-CvmKl75M.js";import{P as ie}from"./plus-CyYmu38g.js";import{C as pe}from"./calendar-BfCctGZ3.js";import{S as de}from"./square-pen-Bg_diimZ.js";import{G as be}from"./graduation-cap-mrkAgQ1z.js";import{S as ye}from"./star-NqUzQi9K.js";import{U as ce}from"./users-BUbPeWYP.js";import{A as Se,S as je,U as Ae}from"./AdminLayout-DXkI0PI6.js";import{B as ge}from"./book-open-D3qBa7nK.js";import{S as xe}from"./shield-Dhn-V6E4.js";import"./file-text-Znh3F_nC.js";import"./user-CAmUnVMn.js";import"./log-out-Bc-nJCmd.js";import"./menu-BL5-W5Xp.js";const ke=({isOpen:y,onClose:E,term:T,onSubmit:B,submitting:R,formatDateForInput:O})=>{const[p,C]=d.useState(""),[j,A]=d.useState("");d.useEffect(()=>{T&&(C(O(T.start_date)),A(O(T.end_date)))},[T,O]);const o=N=>{if(N.preventDefault(),new Date(j)<=new Date(p)){alert("End date must be after start date.");return}B(T.id,{start_date:p,end_date:j})};return y?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full z-50 flex justify-center items-center",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-md p-6",children:[e.jsxs("div",{className:"flex justify-between items-start border-b pb-3 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Edit Dates for ",T.display_name]}),e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:o,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_date",className:"block text-sm font-medium text-gray-700",children:"Start Date"}),e.jsx("input",{type:"date",id:"start_date",value:p,onChange:N=>C(N.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_date",className:"block text-sm font-medium text-gray-700",children:"End Date"}),e.jsx("input",{type:"date",id:"end_date",value:j,onChange:N=>A(N.target.value),required:!0,min:p,className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:E,disabled:R,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:R||!p||!j,className:"inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:R?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})]})]})}):null},ue=y=>{if(!y)return"N/A";const E=y.split("T")[0];return new Date(E+"T00:00:00").toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric"})},_e=y=>y?y.split("T")[0]:"",Te=()=>{var r;const[y,E]=d.useState([]),[T,B]=d.useState(!0),[R,O]=d.useState(!1),[p,C]=d.useState({isOpen:!1,session:null}),[j,A]=d.useState(!1),[o,N]=d.useState({isOpen:!1,term:null,sessionId:null}),{showSuccess:F,showError:k,showWarning:h}=ne(),[f,b]=d.useState({name:"",start_date:"",end_date:"",is_current:!1});d.useEffect(()=>{t()},[]);const t=async()=>{var a,m;try{B(!0);const w=await v.getAcademicSessions();let J=[];w&&w.data&&(J=Array.isArray(w.data)?w.data:w.data.data?w.data.data:[]),E(J)}catch(w){console.error("Error fetching academic sessions:",w),k(((m=(a=w.response)==null?void 0:a.data)==null?void 0:m.message)||"Failed to fetch academic sessions"),E([])}finally{B(!1)}},g=async()=>{var a,m,w,J;if(!f.name||!f.start_date||!f.end_date){k("Please fill in all required fields");return}if(new Date(f.end_date)<=new Date(f.start_date)){k("End date must be after start date");return}A(!0);try{const n=await v.createAcademicSession(f);if(n.data.conflicting_session){h(`Date conflict with ${n.data.conflicting_session.name}. Please adjust dates.`);return}F("Academic session created successfully"),b({name:"",start_date:"",end_date:"",is_current:!1}),O(!1),t()}catch(n){(m=(a=n.response)==null?void 0:a.data)!=null&&m.conflicting_session?h(`Date conflict with ${n.response.data.conflicting_session.name}. Please adjust dates.`):k(((J=(w=n.response)==null?void 0:w.data)==null?void 0:J.message)||"Failed to create academic session")}finally{A(!1)}},M=async a=>{var w,J;const m=y.find(n=>n.is_current);if(!(m&&new Date(m.end_date)>new Date&&!window.confirm(`Setting "${a.name}" as current will deactivate "${m.name}" which is still active. Continue?`))){A(!0);try{const n=await v.setCurrentAcademicSession(a.id);F(n.data.message||"Current academic session updated"),t()}catch(n){k(((J=(w=n.response)==null?void 0:w.data)==null?void 0:J.message)||"Failed to set current session")}finally{A(!1)}}},_=async(a,m)=>{var w,J;A(!0);try{await v.setCurrentTerm(a,m),F("Current term updated"),t()}catch(n){k(((J=(w=n.response)==null?void 0:w.data)==null?void 0:J.message)||"Failed to set current term")}finally{A(!1)}},z=async(a,m)=>{var w,J;G(),A(!0);try{await v.updateTerm(a,m),F("Term dates updated successfully"),t()}catch(n){k(((J=(w=n.response)==null?void 0:w.data)==null?void 0:J.message)||"Failed to update term dates")}finally{A(!1)}},S=async()=>{var a,m;if(p.session){A(!0);try{await v.deleteAcademicSession(p.session.id),F("Academic session deleted successfully"),C({isOpen:!1,session:null}),t()}catch(w){k(((m=(a=w.response)==null?void 0:a.data)==null?void 0:m.message)||"Failed to delete academic session")}finally{A(!1)}}},I=a=>{if(!a)return"";const m=new Date(a).getFullYear();return`${m}/${m+1}`},x=a=>{const m=new Date,w=new Date(a.start_date.split("T")[0]),J=new Date(a.end_date.split("T")[0]);return a.is_current?"current":m<w?"upcoming":m>new Date(J.getTime()+24*60*60*1e3)?"past":"active"},Y=a=>{const m={current:"bg-green-100 text-green-800 border-green-200",active:"bg-blue-100 text-blue-800 border-blue-200",upcoming:"bg-yellow-100 text-yellow-800 border-yellow-200",past:"bg-gray-100 text-gray-800 border-gray-200"};return m[a]||m.past},i=a=>{const m=x(a);return m==="upcoming"||m==="active"},L=a=>x(a)==="upcoming"&&!a.is_current,l=(a,m)=>{N({isOpen:!0,term:a,sessionId:m})},G=()=>{N({isOpen:!1,term:null,sessionId:null})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Academic Sessions Management"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1 flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-1"}),"Sessions automatically update based on dates. Manual changes override automatic updates."]})]}),e.jsxs("button",{onClick:()=>O(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Session"]})]}),R&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Academic Session"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Name *"}),e.jsx("input",{type:"text",value:f.name,onChange:a=>b({...f,name:a.target.value}),placeholder:"e.g., 2024/2025",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date *"}),e.jsx("input",{type:"date",value:f.start_date,onChange:a=>{const m=a.target.value;b({...f,start_date:m,name:f.name||I(m)})},className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date *"}),e.jsx("input",{type:"date",value:f.end_date,onChange:a=>b({...f,end_date:a.target.value}),min:f.start_date,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{type:"checkbox",id:"set-current",checked:f.is_current,onChange:a=>b({...f,is_current:a.target.checked}),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":u.primary.red}}),e.jsx("label",{htmlFor:"set-current",className:"ml-2 text-sm text-gray-700",children:"Set as current session (will override any existing current session)"})]}),f.is_current&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"w-4 h-4 text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-700",children:"This will deactivate the current session and set this one as active immediately."})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:g,disabled:!f.name||!f.start_date||!f.end_date||j,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:j?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Create Session"]})}),e.jsx("button",{onClick:()=>{O(!1),b({name:"",start_date:"",end_date:"",is_current:!1})},disabled:j,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),T?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading sessions..."})]}):e.jsx("div",{className:"space-y-6",children:y.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx(pe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No academic sessions found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding a new academic session."})]}):y.map(a=>{const m=x(a);return e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden border-l-4",style:{borderLeftColor:m==="current"?"#10B981":m==="active"?"#3B82F6":m==="upcoming"?"#F59E0B":"#6B7280"},children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(pe,{className:"w-5 h-5 text-gray-600 mr-2"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:a.name}),e.jsx("span",{className:`ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${Y(m)}`,children:m.charAt(0).toUpperCase()+m.slice(1)}),a.is_manual&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 border border-purple-200",children:"Manual"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["**",ue(a.start_date),"** - **",ue(a.end_date),"**"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[!a.is_current&&i(a)&&e.jsx("button",{onClick:()=>M(a),disabled:j,className:"text-sm px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:"Set as Current"}),L(a)&&e.jsx("button",{onClick:()=>C({isOpen:!0,session:a}),className:"text-red-600 hover:text-red-900",title:"Delete session",children:e.jsx(re,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-3",children:"Terms"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:(a.terms||[]).map(w=>e.jsxs("div",{className:`border rounded-lg p-4 ${w.is_current?"border-green-300 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:w.display_name}),w.is_current&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:"Current"})]}),!w.is_current&&a.is_current&&e.jsx("button",{onClick:()=>_(w.id,a.id),disabled:j,className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 disabled:opacity-50",children:"Set Current"})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Start: **",ue(w.start_date),"**"]}),e.jsxs("div",{children:["End: **",ue(w.end_date),"**"]})]}),e.jsxs("button",{onClick:()=>l(w,a.id),className:"mt-2 text-xs text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Edit Dates"]})]},w.id))})]})]},a.id)})}),e.jsx(oe,{isOpen:p.isOpen,onClose:()=>C({isOpen:!1,session:null}),onConfirm:S,title:"Delete Academic Session",message:"Are you sure you want to delete this academic session? This action cannot be undone. Sessions with associated scores cannot be deleted.",itemName:(r=p.session)==null?void 0:r.name,isLoading:j}),o.isOpen&&o.term&&e.jsx(ke,{isOpen:o.isOpen,onClose:G,term:o.term,onSubmit:z,submitting:j,formatDateForInput:_e})]})},De=()=>{const[y,E]=d.useState([]),[T,B]=d.useState(null),[R,O]=d.useState(!0),[p,C]=d.useState(!1),[j,A]=d.useState(null),[o,N]=d.useState([]),[F,k]=d.useState([]),[h,f]=d.useState(""),[b,t]=d.useState(""),[g,M]=d.useState(!1),{showSuccess:_,showError:z}=ne(),[S,I]=d.useState({name:"",type:"all_promote",criteria:{},description:"",is_active:!1});d.useEffect(()=>{x(),Y(),i()},[]);const x=async()=>{var n,q;try{O(!0);const $=await v.getPromotionRules();E(((n=$.data)==null?void 0:n.data)||$.data||[]),B(((q=$.data)==null?void 0:q.active_rule)||$.active_rule||null)}catch{z("Failed to fetch promotion rules")}finally{O(!1)}},Y=async()=>{var n;try{const q=await v.getAcademicSessions(),$=((n=q.data)==null?void 0:n.data)||q.data||[];N($);const X=$.find(s=>s.is_current)||$[0];X&&f(X.id)}catch{z("Failed to fetch academic sessions")}},i=async()=>{var n;try{const q=await v.getClasses(),$=((n=q.data)==null?void 0:n.data)||q.data||[];k(Array.isArray($)?$:[])}catch{z("Failed to fetch classes")}},L=async n=>{var q,$;n.preventDefault();try{j?(await v.updatePromotionRule(j.id,S),_("Promotion rule updated successfully")):(await v.createPromotionRule(S),_("Promotion rule created successfully")),m(),x()}catch(X){z((($=(q=X.response)==null?void 0:q.data)==null?void 0:$.message)||X.message||"Failed to save promotion rule")}},l=n=>{A(n),I({name:n.name,type:n.type,criteria:n.criteria||{},description:n.description||"",is_active:n.is_active||!1}),C(!0)},G=async n=>{var q,$;if(window.confirm("Are you sure you want to delete this promotion rule?"))try{await v.deletePromotionRule(n.id),_("Promotion rule deleted successfully"),x()}catch(X){z((($=(q=X.response)==null?void 0:q.data)==null?void 0:$.message)||X.message||"Failed to delete promotion rule")}},r=async n=>{var q,$;try{await v.updatePromotionRule(n.id,{...n,is_active:!0}),_("Promotion rule activated"),x()}catch(X){z((($=(q=X.response)==null?void 0:q.data)==null?void 0:$.message)||X.message||"Failed to activate rule")}},a=async()=>{var n,q,$,X,s;if(!h){z("Please select an academic session");return}if(window.confirm("This will promote eligible students and graduate JSS3/SS3 students. Continue?"))try{M(!0);const c={academic_session_id:h};b&&(c.class_id=b);const D=await v.promoteStudents(c);_(`Promotion completed: ${((n=D.data)==null?void 0:n.promoted)||0} promoted, ${((q=D.data)==null?void 0:q.repeated)||0} repeated, ${(($=D.data)==null?void 0:$.graduated)||0} graduated`)}catch(c){z(((s=(X=c.response)==null?void 0:X.data)==null?void 0:s.message)||c.message||"Failed to promote students")}finally{M(!1)}},m=()=>{I({name:"",type:"all_promote",criteria:{},description:"",is_active:!1}),A(null),C(!1)},w=n=>({all_promote:"All Students Promote",minimum_grades:"Minimum Grades Required",minimum_average:"Minimum Average Score",minimum_subjects_passed:"Minimum Subjects Passed"})[n]||n,J=()=>S.type==="minimum_grades"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum A Grades"}),e.jsx("input",{type:"number",min:"0",value:S.criteria.min_a_count||0,onChange:n=>I({...S,criteria:{...S.criteria,min_a_count:parseInt(n.target.value)||0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum B Grades"}),e.jsx("input",{type:"number",min:"0",value:S.criteria.min_b_count||0,onChange:n=>I({...S,criteria:{...S.criteria,min_b_count:parseInt(n.target.value)||0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum C Grades"}),e.jsx("input",{type:"number",min:"0",value:S.criteria.min_c_count||0,onChange:n=>I({...S,criteria:{...S.criteria,min_c_count:parseInt(n.target.value)||0}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}):S.type==="minimum_average"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Average Score (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",value:S.criteria.min_average||50,onChange:n=>I({...S,criteria:{...S.criteria,min_average:parseFloat(n.target.value)||50}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}):S.type==="minimum_subjects_passed"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Minimum Subjects Passed"}),e.jsx("input",{type:"number",min:"1",value:S.criteria.min_passed||5,onChange:n=>I({...S,criteria:{...S.criteria,min_passed:parseInt(n.target.value)||5}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}):null;return R?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading promotion rules..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Student Promotion Management"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Set promotion rules and promote students after completing academic sessions"})]}),e.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Promotion Rule"]})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h4",{className:"text-md font-semibold text-gray-900",children:"Promotion Rules"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:y.length===0?e.jsx("div",{className:"px-6 py-8 text-center text-gray-500",children:"No promotion rules found. Create one to get started."}):y.map(n=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900",children:n.name}),n.is_active&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Active"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Type: ",w(n.type)]}),n.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n.description}),Object.keys(n.criteria||{}).length>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Criteria: ",JSON.stringify(n.criteria)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!n.is_active&&e.jsx("button",{onClick:()=>r(n),className:"text-blue-600 hover:text-blue-800 text-sm",children:"Activate"}),e.jsx("button",{onClick:()=>l(n),className:"text-blue-600 hover:text-blue-800",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>G(n),className:"text-red-600 hover:text-red-800",children:e.jsx(re,{className:"w-4 h-4"})})]})]})},n.id))})]}),p&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:j?"Edit Promotion Rule":"Create Promotion Rule"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rule Name *"}),e.jsx("input",{type:"text",required:!0,value:S.name,onChange:n=>I({...S,name:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"e.g., Standard Promotion Rule"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Promotion Type *"}),e.jsxs("select",{required:!0,value:S.type,onChange:n=>I({...S,type:n.target.value,criteria:{}}),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"all_promote",children:"All Students Promote"}),e.jsx("option",{value:"minimum_grades",children:"Minimum Grades Required"}),e.jsx("option",{value:"minimum_average",children:"Minimum Average Score"}),e.jsx("option",{value:"minimum_subjects_passed",children:"Minimum Subjects Passed"})]})]}),J(),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:S.description,onChange:n=>I({...S,description:n.target.value}),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:"Describe this promotion rule..."})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:S.is_active,onChange:n=>I({...S,is_active:n.target.checked}),className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-700",children:"Activate this rule"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsxs("button",{type:"submit",className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white",style:{backgroundColor:u.primary.red},children:[e.jsx(le,{className:"inline mr-2 h-4 w-4"}),j?"Update Rule":"Create Rule"]})]})]})]}),T&&e.jsxs("div",{className:"bg-white shadow rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Run Promotion Process"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"After all three terms of an academic session are completed, you can run the promotion process. Students in JSS3 and SS3 will be marked as graduated. Other students will be promoted based on the active rule."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Academic Session *"}),e.jsxs("select",{required:!0,value:h,onChange:n=>f(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Select academic session"}),o.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class (Optional - Leave empty to promote all classes)"}),e.jsxs("select",{value:b,onChange:n=>t(n.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Classes"}),F.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsx("button",{onClick:a,disabled:g||!h,className:"w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:g?e.jsx(e.Fragment,{children:"Processing..."}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Run Promotion Process"]})})]})]})]})},Ee=()=>{var G;const{showSuccess:y,showError:E}=ne(),[T,B]=d.useState([]),[R,O]=d.useState([]),[p,C]=d.useState(!0),[j,A]=d.useState(!1),[o,N]=d.useState(null),[F,k]=d.useState({isOpen:!1,config:null}),[h,f]=d.useState(!1),[b,t]=d.useState({name:"",description:"",class_ids:[],grades:[{grade:"A",min:80,max:100,remark:"Excellent"},{grade:"B",min:70,max:79,remark:"Very Good"},{grade:"C",min:60,max:69,remark:"Good"},{grade:"D",min:50,max:59,remark:"Fair"},{grade:"E",min:40,max:49,remark:"Pass"},{grade:"F",min:0,max:39,remark:"Fail"}],is_active:!0,is_default:!1});d.useEffect(()=>{g(),M()},[]);const g=async()=>{try{const r=await v.getGradingConfigurations();let a=[];Array.isArray(r)?a=r:r!=null&&r.data&&(Array.isArray(r.data)?a=r.data:r.data.data&&Array.isArray(r.data.data)&&(a=r.data.data)),B(Array.isArray(a)?a:[])}catch{E("Error loading grading configurations"),B([])}finally{C(!1)}},M=async()=>{var r;try{const a=await v.getClasses();let m=a==null?void 0:a.data;Array.isArray(a)?m=a:(r=a==null?void 0:a.data)!=null&&r.data&&Array.isArray(a.data.data)&&(m=a.data.data),O(m||[])}catch{}},_=()=>{t({name:"",description:"",class_ids:[],grades:[{grade:"A",min:80,max:100,remark:"Excellent"},{grade:"B",min:70,max:79,remark:"Very Good"},{grade:"C",min:60,max:69,remark:"Good"},{grade:"D",min:50,max:59,remark:"Fair"},{grade:"E",min:40,max:49,remark:"Pass"},{grade:"F",min:0,max:39,remark:"Fail"}],is_active:!0,is_default:!1}),N(null),A(!1)},z=()=>{t(r=>({...r,grades:[...r.grades,{grade:"",min:0,max:100,remark:""}]}))},S=r=>{t(a=>({...a,grades:a.grades.filter((m,w)=>w!==r)}))},I=(r,a,m)=>{t(w=>({...w,grades:w.grades.map((J,n)=>n===r?{...J,[a]:a==="min"||a==="max"?parseFloat(m)||0:m}:J)}))},x=async()=>{if(!b.name||b.grades.length===0||b.class_ids.length===0){E("Please fill all required fields");return}for(const r of b.grades)if(!r.grade||r.min<0||r.max>100||r.min>r.max){E("Please ensure all grade ranges are valid (0-100)");return}f(!0);try{o?(await v.updateGradingConfiguration(o.id,b),y("Grading configuration updated successfully")):(await v.createGradingConfiguration(b),y("Grading configuration created successfully")),g(),_()}catch(r){E(r.message||"Error saving grading configuration")}finally{f(!1)}},Y=r=>{t({name:r.name,description:r.description||"",class_ids:r.class_ids||[],grades:r.grades||[],is_active:r.is_active,is_default:r.is_default}),N(r),A(!0)},i=async()=>{if(F.config){f(!0);try{await v.deleteGradingConfiguration(F.config.id),y("Grading configuration deleted successfully"),g(),k({isOpen:!1,config:null})}catch(r){E(r.message||"Error deleting grading configuration")}finally{f(!1)}}},L=async r=>{try{await v.setDefaultGradingConfiguration(r.id),y("Default grading configuration updated"),g()}catch(a){E(a.message||"Error setting default configuration")}},l=r=>{t(a=>({...a,class_ids:a.class_ids.includes(r)?a.class_ids.filter(m=>m!==r):[...a.class_ids,r]}))};return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:u.primary.red}})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Grading Configurations"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configure custom grading systems for different class groups"})]}),e.jsxs("button",{onClick:()=>{_(),A(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Configuration"]})]}),j&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:o?"Edit Grading Configuration":"New Grading Configuration"}),e.jsx("button",{onClick:_,className:"text-gray-400 hover:text-gray-600",children:e.jsx(fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:r=>t(a=>({...a,name:r.target.value})),placeholder:"e.g., JSS1-JSS3 Grading",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:b.description,onChange:r=>t(a=>({...a,description:r.target.value})),placeholder:"Optional description",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Applicable Classes *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 max-h-40 overflow-y-auto border border-gray-200 rounded-lg p-3",children:R.map(r=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.class_ids.includes(r.id),onChange:()=>l(r.id),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:r.name})]},r.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Grade Ranges *"}),e.jsx("button",{onClick:z,className:"text-sm text-red-600 hover:text-red-700 font-medium",children:"+ Add Grade"})]}),e.jsx("div",{className:"space-y-2",children:b.grades.map((r,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"text",value:r.grade,onChange:m=>I(a,"grade",m.target.value),placeholder:"Grade",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-red-500"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",value:r.min,onChange:m=>I(a,"min",m.target.value),placeholder:"Min",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-red-500"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"number",value:r.max,onChange:m=>I(a,"max",m.target.value),placeholder:"Max",min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-red-500"})}),e.jsx("div",{className:"col-span-3",children:e.jsx("input",{type:"text",value:r.remark,onChange:m=>I(a,"remark",m.target.value),placeholder:"Remark",className:"w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-red-500"})}),e.jsx("div",{className:"col-span-1",children:b.grades.length>1&&e.jsx("button",{onClick:()=>S(a),className:"text-red-600 hover:text-red-700",children:e.jsx(re,{className:"h-4 w-4"})})})]},a))})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.is_active,onChange:r=>t(a=>({...a,is_active:r.target.checked})),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b.is_default,onChange:r=>t(a=>({...a,is_default:r.target.checked})),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Set as Default"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:x,disabled:h,className:"px-4 py-2 text-white rounded-lg font-semibold hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:h?"Saving...":o?"Update":"Create"})]})]}),e.jsx("div",{className:"space-y-4",children:T.length===0?e.jsx("div",{className:"text-center py-12 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:"No grading configurations found. Create one to get started."})}):T.map(r=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:r.name}),r.is_default&&e.jsxs("span",{className:"flex items-center text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Default"]}),r.is_active?e.jsxs("span",{className:"flex items-center text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsx("span",{className:"flex items-center text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded",children:"Inactive"})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:r.description}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Classes:"})," ",r.class_ids&&r.class_ids.length>0?R.filter(a=>r.class_ids.includes(a.id)).map(a=>a.name).join(", "):"None selected"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[!r.is_default&&e.jsx("button",{onClick:()=>L(r),className:"text-yellow-600 hover:text-yellow-700",title:"Set as default",children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>Y(r),className:"text-blue-600 hover:text-blue-700",title:"Edit",children:e.jsx(de,{className:"h-5 w-5"})}),!r.is_default&&e.jsx("button",{onClick:()=>k({isOpen:!0,config:r}),className:"text-red-600 hover:text-red-700",title:"Delete",children:e.jsx(re,{className:"h-5 w-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-2",children:r.grades&&r.grades.map((a,m)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border border-gray-200",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:a.grade}),e.jsxs("div",{className:"text-xs text-gray-600",children:[a.min,"-",a.max]}),a.remark&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.remark})]},m))})]},r.id))}),e.jsx(oe,{isOpen:F.isOpen,onClose:()=>k({isOpen:!1,config:null}),onConfirm:i,title:"Delete Grading Configuration",message:"Are you sure you want to delete this grading configuration? This action cannot be undone.",itemName:(G=F.config)==null?void 0:G.name,isLoading:h})]})},Fe=()=>{var q,$,X;const[y,E]=d.useState([]),[T,B]=d.useState([]),[R,O]=d.useState([]),[p,C]=d.useState(!0),[j,A]=d.useState(!1),[o,N]=d.useState(null),[F,k]=d.useState({isOpen:!1,teacher:null}),[h,f]=d.useState(!1),{showSuccess:b,showError:t}=ne(),[g,M]=d.useState({name:"",email:"",phone:"",username:"",password:"",role:"teacher",assignedClasses:[],assignedSubjects:[]});d.useEffect(()=>{_(),z(),S()},[]);const _=async()=>{try{const s=await v.getUsers();let c=[];s&&s.data&&(Array.isArray(s.data)?c=s.data:s.data.data&&Array.isArray(s.data.data)&&(c=s.data.data)),H.component("TeachersTab","fetchTeachers - Users loaded",{count:c.length});const D=c.filter(P=>P.role==="teacher");let Q={},Z={};try{const P=await v.getTeacherAssignments();let K=[];P&&P.data&&(Array.isArray(P.data)?K=P.data:P.data.data&&Array.isArray(P.data.data)&&(K=P.data.data)),H.component("TeachersTab","fetchTeachers - Assignments loaded",{count:K.length}),K.forEach(U=>{const W=U.teacher_id;Q[W]||(Q[W]={classes:new Set,subjects:new Set},Z[W]={classIds:new Set,subjectIds:new Set,assignmentIds:[],assignments:[]});const se=U.schoolClass||U.school_class||U.class;se&&se.name&&(Q[W].classes.add(se.name),Z[W].classIds.add(se.id)),U.subject&&U.subject.name&&(Q[W].subjects.add(U.subject.name),Z[W].subjectIds.add(U.subject.id)),U.id&&Z[W].assignmentIds.push(U.id),U.id&&U.class_id&&U.subject_id&&Z[W].assignments.push({id:U.id,class_id:U.class_id,subject_id:U.subject_id})})}catch(P){H.warn("Could not fetch teacher assignments:",P)}const ee=D.map(P=>{var K,U,W,se,me,te;return{...P,assignedClasses:Array.from(((K=Q[P.id])==null?void 0:K.classes)||[]),assignedSubjects:Array.from(((U=Q[P.id])==null?void 0:U.subjects)||[]),assignedClassIds:Array.from(((W=Z[P.id])==null?void 0:W.classIds)||[]),assignedSubjectIds:Array.from(((se=Z[P.id])==null?void 0:se.subjectIds)||[]),assignmentIds:((me=Z[P.id])==null?void 0:me.assignmentIds)||[],assignments:((te=Z[P.id])==null?void 0:te.assignments)||[]}});E(ee)}catch{t("Failed to fetch teachers")}finally{C(!1)}},z=async()=>{try{const s=await v.getSubjects();let c=[];s&&s.data&&(Array.isArray(s.data)?c=s.data:s.data.data&&Array.isArray(s.data.data)&&(c=s.data.data)),H.component("TeachersTab","fetchSubjects - Subjects loaded",{count:c.length}),B(c)}catch{B([])}},S=async()=>{try{const s=await v.getClasses();let c=[];s&&s.data&&(Array.isArray(s.data)?c=s.data:s.data.data&&Array.isArray(s.data.data)&&(c=s.data.data)),H.component("TeachersTab","fetchClasses - Classes loaded",{count:c.length}),O(c)}catch{O([])}},I=s=>{if(!s)return"";const D=s.toLowerCase().replace(/[^a-z\s]/g,"").trim().split(" ").filter(Q=>Q.length>0);return D.length>=2?`${D[0]}.${D[D.length-1]}.gloveacademy`:D.length===1?`${D[0]}.gloveacademy`:""},x=(s,c)=>{if(M(D=>({...D,[s]:c})),s==="name"){const D=I(c);M(Q=>({...Q,username:D}))}},Y=s=>{if(!s)return!0;const c=s.replace(/\D/g,"");return c.length>=10&&c.length<=13},i=async()=>{var s,c,D,Q;if(!g.name||!g.username){t("Please fill in all required fields (Name and Username)");return}if(g.phone&&!Y(g.phone)){t("Please enter a valid phone number (10-13 digits)");return}f(!0);try{const Z={name:g.name,email:g.email||null,username:g.username,password:g.password||"password",role:"teacher",phone:g.phone||null,is_active:!0},ee=await v.createUser(Z);let P=null;if((s=ee.data)!=null&&s.id?P=ee.data.id:ee.id?P=ee.id:(c=ee.user)!=null&&c.id?P=ee.user.id:(Q=(D=ee.data)==null?void 0:D.user)!=null&&Q.id&&(P=ee.data.user.id),H.component("TeachersTab","handleAddTeacher - Teacher created",{teacherId:P}),!P){t("Teacher created but could not extract teacher ID for assignments");return}const K=[];for(const U of g.assignedClasses)for(const W of g.assignedSubjects)K.push({teacher_id:parseInt(P),subject_id:parseInt(W),class_id:parseInt(U)});if(H.component("TeachersTab","handleAddTeacher - Creating assignments",{count:K.length}),K.length>0)try{const U=K.map(async W=>await v.assignTeacher(W));await Promise.all(U),H.component("TeachersTab","handleAddTeacher - All assignments created")}catch(U){H.error("Assignment error:",U),t(`Teacher created successfully, but assignments failed: ${U.message}. You can assign classes and subjects manually later.`)}K.length>0?b("Teacher added and assigned successfully"):b("Teacher added successfully"),M({name:"",email:"",phone:"",username:"",password:"",role:"teacher",assignedClasses:[],assignedSubjects:[]}),A(!1),_()}catch(Z){t(Z.message||"Failed to add teacher")}finally{f(!1)}},L=s=>{M(c=>({...c,assignedClasses:c.assignedClasses.includes(s)?c.assignedClasses.filter(D=>D!==s):[...c.assignedClasses,s]}))},l=s=>{M(c=>({...c,assignedSubjects:c.assignedSubjects.includes(s)?c.assignedSubjects.filter(D=>D!==s):[...c.assignedSubjects,s]}))},G=s=>{N(c=>({...c,assignedClassIds:c.assignedClassIds.includes(s)?c.assignedClassIds.filter(D=>D!==s):[...c.assignedClassIds,s]}))},r=s=>{N(c=>({...c,assignedSubjectIds:c.assignedSubjectIds.includes(s)?c.assignedSubjectIds.filter(D=>D!==s):[...c.assignedSubjectIds,s]}))},a=async(s,c,D)=>{var Q,Z,ee;f(!0);try{await v.updateUser(s,c);let P=!0;if(D){const K=y.find(V=>V.id===s),U=(K==null?void 0:K.assignments)||[],W=new Set(D.map(V=>`${V.class_id}-${V.subject_id}`)),se=U.filter(V=>{const ae=`${V.class_id}-${V.subject_id}`;return!W.has(ae)}),me=new Set(U.map(V=>`${V.class_id}-${V.subject_id}`)),te=D.filter(V=>{const ae=`${V.class_id}-${V.subject_id}`;return!me.has(ae)});if(se.length>0)try{await Promise.all(se.map(V=>v.removeTeacherAssignment(V.id)))}catch(V){H.error("Error removing old assignments:",V),P=!1}if(te.length>0)try{const ae=(await Promise.allSettled(te.map(he=>v.assignTeacher(he)))).filter(he=>he.status==="rejected");if(ae.length>0)if(H.warn("Some assignments failed to create:",ae),P=!1,ae.length===te.length){t("Teacher updated but assignments failed. Please check and update manually.");return}else{b(`Teacher updated. ${te.length-ae.length} of ${te.length} assignments created successfully.`),N(null),_();return}}catch(V){H.error("Error creating new assignments:",V),P=!1;const ae=V.message||((Z=(Q=V.response)==null?void 0:Q.data)==null?void 0:Z.message)||"";if(((ee=V.response)==null?void 0:ee.status)===400&&ae.includes("already assigned"))H.log("Some assignments already exist, skipping...");else{t("Teacher updated but some assignments failed. Please check and update manually."),N(null),_();return}}}P&&b("Teacher updated successfully"),N(null),_()}catch(P){t(P.message||"Failed to update teacher")}finally{f(!1)}},m=async()=>{if(F.teacher){f(!0);try{await v.deleteUser(F.teacher.id,!0),b("Teacher permanently deleted successfully"),k({isOpen:!1,teacher:null}),_()}catch(s){t(s.message||"Failed to delete teacher")}finally{f(!1)}}},w=s=>{k({isOpen:!0,teacher:s})},J=()=>{k({isOpen:!1,teacher:null})},n=s=>{N({...s,assignedClassIds:s.assignedClassIds||[],assignedSubjectIds:s.assignedSubjectIds||[]})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Manage Teachers"}),e.jsxs("button",{onClick:()=>A(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Teacher"]})]}),j&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Teacher"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",value:g.name,onChange:s=>x("name",s.target.value),placeholder:"Enter full name",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:g.username,onChange:s=>x("username",s.target.value),placeholder:"Username (auto-generated from name)",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address (Optional)"}),e.jsx("input",{type:"email",value:g.email,onChange:s=>x("email",s.target.value),placeholder:"teacher@gloveacademy.edu.ng",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional - Leave empty if teacher does not have an email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number (Optional)"}),e.jsx("input",{type:"tel",value:g.phone,onChange:s=>{const c=s.target.value;(c===""||/^[\d\s\+\-()]+$/.test(c))&&x("phone",c)},placeholder:"+234 801 234 5678 or 08012345678",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter a valid phone number (10-13 digits)"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",value:g.password,onChange:s=>x("password",s.target.value),placeholder:"Leave blank for default password",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'If left blank, default password "password" will be used'})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Classes"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:(R&&Array.isArray(R)?R:[]).map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:g.assignedClasses.includes(s.id),onChange:()=>L(s.id),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":u.primary.red}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.name})]},s.id))}),g.assignedClasses.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select classes this teacher will teach"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Subjects"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:(T&&Array.isArray(T)?T:[]).map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:g.assignedSubjects.includes(s.id),onChange:()=>l(s.id),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":u.primary.red}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.name})]},s.id))}),g.assignedSubjects.length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select subjects this teacher will teach"})]}),g.assignedClasses.length>0&&g.assignedSubjects.length>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Assignment Summary:"})," This teacher will be assigned to teach"," ",e.jsx("strong",{children:g.assignedSubjects.length})," subject(s) across"," ",e.jsx("strong",{children:g.assignedClasses.length})," class(es), creating"," ",e.jsx("strong",{children:g.assignedClasses.length*g.assignedSubjects.length})," total assignment(s)."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:i,disabled:!g.name||!g.username||h,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:h?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Teacher"]})}),e.jsx("button",{onClick:()=>{A(!1),M({name:"",email:"",phone:"",username:"",password:"",role:"teacher",assignedClasses:[],assignedSubjects:[]})},disabled:h,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),p?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading teachers..."})]}):e.jsx("div",{className:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Classes To Teach"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Assigned Subjects To Teach"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(ce,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No teachers found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding a new teacher."})]})}):y.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center mr-3",children:e.jsx(ce,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",s.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:s.username})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:s.email||"Not provided"}),e.jsx("div",{className:"text-sm text-gray-500",children:s.phone||"Not provided"})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.assignedClasses&&s.assignedClasses.length>0?s.assignedClasses.slice(0,2).map((c,D)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-50 text-purple-700",children:c},D)):e.jsx("span",{className:"text-xs text-gray-400",children:"No classes assigned"}),s.assignedClasses&&s.assignedClasses.length>2&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-600",children:["+",s.assignedClasses.length-2," more"]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.assignedSubjects&&s.assignedSubjects.length>0?s.assignedSubjects.slice(0,2).map((c,D)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-50 text-green-700",children:c},D)):e.jsx("span",{className:"text-xs text-gray-400",children:"No subjects assigned"}),s.assignedSubjects&&s.assignedSubjects.length>2&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-50 text-gray-600",children:["+",s.assignedSubjects.length-2," more"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(s),className:"text-blue-600 hover:text-blue-900",title:"Edit teacher",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>w(s),className:"text-red-600 hover:text-red-900",title:"Delete teacher",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},s.id))})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Teacher"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",value:o.name,onChange:s=>N({...o,name:s.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:o.username,onChange:s=>N({...o,username:s.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),e.jsx("input",{type:"email",value:o.email||"",onChange:s=>N({...o,email:s.target.value||null}),placeholder:"teacher@gloveacademy.edu.ng",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional - Leave empty if teacher does not have an email address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone (Optional)"}),e.jsx("input",{type:"tel",value:o.phone||"",onChange:s=>{const c=s.target.value;(c===""||/^[\d\s\+\-()]+$/.test(c))&&N({...o,phone:c||null})},placeholder:"+234 801 234 5678 or 08012345678",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter a valid phone number (10-13 digits)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:o.is_active?"active":"inactive",onChange:s=>N({...o,is_active:s.target.value==="active"}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Classes"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md p-2",children:(R&&Array.isArray(R)?R:[]).map(s=>{var c;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((c=o.assignedClassIds)==null?void 0:c.includes(s.id))||!1,onChange:()=>G(s.id),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":u.primary.red}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.name})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Subjects"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md p-2",children:(T&&Array.isArray(T)?T:[]).map(s=>{var c;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((c=o.assignedSubjectIds)==null?void 0:c.includes(s.id))||!1,onChange:()=>r(s.id),className:"h-4 w-4 rounded border-gray-300 focus:ring-2",style:{"--tw-ring-color":u.primary.red}}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:s.name})]},s.id)})})]}),((q=o.assignedClassIds)==null?void 0:q.length)>0&&(($=o.assignedSubjectIds)==null?void 0:$.length)>0&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Assignment Summary:"})," This teacher will be assigned to teach"," ",e.jsx("strong",{children:o.assignedSubjectIds.length})," subject(s) across"," ",e.jsx("strong",{children:o.assignedClassIds.length})," class(es), creating"," ",e.jsx("strong",{children:o.assignedClassIds.length*o.assignedSubjectIds.length})," total assignment(s)."]})})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>{const s=[];for(const c of o.assignedClassIds||[])for(const D of o.assignedSubjectIds||[])s.push({teacher_id:parseInt(o.id),subject_id:parseInt(D),class_id:parseInt(c)});if(o.phone&&!Y(o.phone)){t("Please enter a valid phone number (10-13 digits)");return}a(o.id,{name:o.name,username:o.username,email:o.email||null,phone:o.phone||null,role:"teacher",is_active:o.is_active},s)},disabled:!o.name||!o.username||h,className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:h?"Updating...":"Update Teacher"}),e.jsx("button",{onClick:()=>N(null),className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]})})}),e.jsx(oe,{isOpen:F.isOpen,onClose:J,onConfirm:m,title:"Delete Teacher",message:"Are you sure you want to delete this teacher? This action cannot be undone and will remove all associated data.",itemName:(X=F.teacher)==null?void 0:X.name,isLoading:h})]})},Qe=({activeTab:y})=>{const[E,T]=d.useState(y||"classes"),[B,R]=d.useState(!1);d.useEffect(()=>{y==="academic-sessions"&&T("academic-sessions")},[y]);const O=[{id:"classes",name:"Classes",icon:ge},{id:"subjects",name:"Subjects",icon:je},{id:"teachers",name:"Teachers",icon:ce},{id:"activities",name:"Teacher Activities",icon:Ae},{id:"academic-sessions",name:"Academic Sessions",icon:pe},{id:"promotion",name:"Student Promotion",icon:be},{id:"grading",name:"Grading Configuration",icon:je},{id:"admins",name:"Add Admin",icon:xe}],p=()=>{switch(E){case"classes":return e.jsx(Ne,{});case"subjects":return e.jsx(Pe,{});case"teachers":return e.jsx(Fe,{});case"activities":return e.jsx(Oe,{});case"academic-sessions":return e.jsx(Te,{});case"promotion":return e.jsx(De,{});case"grading":return e.jsx(Ee,{});case"admins":return e.jsx(Me,{});default:return e.jsx(Ne,{})}};return e.jsx(Se,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl",children:"Settings"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your school's classes, subjects, teachers, and assignments."})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8 overflow-x-auto py-2",children:O.map(C=>{const j=C.icon;return e.jsxs("button",{onClick:()=>T(C.id),className:`
                  group inline-flex items-center py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap
                  ${E===C.id?"border-red-500 text-red-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,style:E===C.id?{borderColor:u.primary.red,color:u.primary.red}:{},children:[e.jsx(j,{className:"mr-2 h-5 w-5"}),C.name]},C.id)})})}),e.jsx("div",{className:"bg-white shadow rounded-lg",children:e.jsx(p,{})})]})})},Ne=()=>{var Y;const[y,E]=d.useState([]),[T,B]=d.useState([]),[R,O]=d.useState(!0),[p,C]=d.useState(!1),[j,A]=d.useState(null),[o,N]=d.useState({isOpen:!1,class:null}),[F,k]=d.useState(!1),{showSuccess:h,showError:f}=ne(),[b,t]=d.useState({name:"",form_teacher_id:"",description:""});d.useEffect(()=>{g(),M()},[]);const g=async()=>{try{const i=await v.getClasses();H.component("Settings","fetchClasses - Response received");let L=[];if(i!=null&&i.data){if(i.data.data&&Array.isArray(i.data.data))L=i.data.data;else if(Array.isArray(i.data))L=i.data;else if(typeof i.data=="object"){const l=Object.keys(i.data);for(const G of l)if(Array.isArray(i.data[G])){L=i.data[G];break}}}Array.isArray(L)||(H.warn("Settings - Unexpected classes response structure:",i),L=[]),H.component("Settings","fetchClasses - Data loaded",{count:L.length}),E(L)}catch{f("Failed to fetch classes"),E([])}finally{O(!1)}},M=async()=>{try{const i=await v.getUsers();H.component("Settings","fetchTeachers - Response received");let L=[];i&&i.data&&(Array.isArray(i.data)?L=i.data:i.data.data&&Array.isArray(i.data.data)&&(L=i.data.data)),H.component("Settings","fetchTeachers - Data loaded",{count:L.length});const l=Array.isArray(L)?L:[];B(l.filter(G=>G.role==="teacher"))}catch{B([])}},_=async()=>{if(!b.name){f("Please fill in all required fields");return}k(!0);try{const i={name:b.name,form_teacher_id:b.form_teacher_id||null,description:b.description};await v.createClass(i),h("Class added successfully"),t({name:"",form_teacher_id:"",description:""}),C(!1),g()}catch(i){f(i.message||"Failed to add class")}finally{k(!1)}},z=async(i,L)=>{k(!0);try{await v.updateClass(i,L),h("Class updated successfully"),A(null),g()}catch(l){f(l.message||"Failed to update class")}finally{k(!1)}},S=async()=>{if(o.class){k(!0);try{await v.deleteClass(o.class.id),h("Class deleted successfully"),N({isOpen:!1,class:null}),g()}catch(i){f(i.message||"Failed to delete class")}finally{k(!1)}}},I=i=>{N({isOpen:!0,class:i})},x=()=>{N({isOpen:!1,class:null})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Manage Classes"}),e.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Class"]})]}),p&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Class"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class Name *"}),e.jsx("input",{type:"text",value:b.name,onChange:i=>t({...b,name:i.target.value}),placeholder:"e.g., JSS 1A, SS 2B",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Form Teacher"}),e.jsxs("select",{value:b.form_teacher_id,onChange:i=>t({...b,form_teacher_id:i.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"",children:"Select a teacher (optional)"}),(T&&Array.isArray(T)?T:[]).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:b.description,onChange:i=>t({...b,description:i.target.value}),rows:3,placeholder:"Brief description of the class",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:_,disabled:!b.name||F,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:F?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Class"]})}),e.jsx("button",{onClick:()=>{C(!1),t({name:"",form_teacher_id:"",description:""})},disabled:F,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),R?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading classes..."})]}):e.jsx("div",{className:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Students"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Form Teacher"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(ce,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No classes found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding a new class."})]})}):(y&&Array.isArray(y)?y:[]).map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(ce,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:i.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",i.id]}),i.description&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:i.description})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[i.students_count||0," students"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.form_teacher?i.form_teacher.name:"Not assigned"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>A(i),className:"text-blue-600 hover:text-blue-900",title:"Edit class",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>I(i),className:"text-red-600 hover:text-red-900",title:"Delete class",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},i.id))})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Class"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class Name *"}),e.jsx("input",{type:"text",value:j.name,onChange:i=>A({...j,name:i.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Form Teacher"}),e.jsxs("select",{value:j.form_teacher_id||"",onChange:i=>A({...j,form_teacher_id:i.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"",children:"Select form teacher..."}),(T&&Array.isArray(T)?T:[]).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:j.description||"",onChange:i=>A({...j,description:i.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>z(j.id,j),disabled:!j.name||F,className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:F?"Updating...":"Update Class"}),e.jsx("button",{onClick:()=>A(null),className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]})})}),e.jsx(oe,{isOpen:o.isOpen,onClose:x,onConfirm:S,title:"Delete Class",message:"Are you sure you want to delete this class? This action cannot be undone and will remove all associated data including students and scores.",itemName:(Y=o.class)==null?void 0:Y.name,isLoading:F})]})},Pe=()=>{var I;const[y,E]=d.useState([]),[T,B]=d.useState(!0),[R,O]=d.useState(!1),[p,C]=d.useState(null),[j,A]=d.useState({isOpen:!1,subject:null}),[o,N]=d.useState(!1),{showSuccess:F,showError:k}=ne(),[h,f]=d.useState({name:"",code:"",description:""});d.useEffect(()=>{b()},[]);const b=async()=>{try{const x=await v.getSubjects();H.component("Settings","fetchSubjects - Response received");let Y=[];x&&x.data&&(Array.isArray(x.data)?Y=x.data:x.data.data&&Array.isArray(x.data.data)&&(Y=x.data.data)),H.component("Settings","fetchSubjects - Data loaded",{count:Y.length}),E(Y)}catch{k("Failed to fetch subjects"),E([])}finally{B(!1)}},t=(x,Y)=>{f(i=>({...i,[x]:Y}))},g=async()=>{if(!h.name||!h.code){k("Please fill in all required fields");return}N(!0);try{const x={name:h.name,code:h.code.toUpperCase(),description:h.description};await v.createSubject(x),F("Subject added successfully"),f({name:"",code:"",description:""}),O(!1),b()}catch(x){k(x.message||"Failed to add subject")}finally{N(!1)}},M=async(x,Y)=>{N(!0);try{await v.updateSubject(x,Y),F("Subject updated successfully"),C(null),b()}catch(i){k(i.message||"Failed to update subject")}finally{N(!1)}},_=async()=>{if(j.subject){N(!0);try{await v.deleteSubject(j.subject.id),F("Subject deleted successfully"),A({isOpen:!1,subject:null}),b()}catch(x){k(x.message||"Failed to delete subject")}finally{N(!1)}}},z=x=>{A({isOpen:!0,subject:x})},S=()=>{A({isOpen:!1,subject:null})};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Manage Subjects"}),e.jsxs("button",{onClick:()=>O(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Subject"]})]}),R&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Subject"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Name *"}),e.jsx("input",{type:"text",value:h.name,onChange:x=>t("name",x.target.value),placeholder:"e.g., Mathematics",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Code *"}),e.jsx("input",{type:"text",value:h.code,onChange:x=>t("code",x.target.value),placeholder:"e.g., MATH",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:h.description,onChange:x=>t("description",x.target.value),rows:3,placeholder:"Brief description of the subject",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:g,disabled:!h.name||!h.code||o,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:o?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Subject"]})}),e.jsx("button",{onClick:()=>{O(!1),f({name:"",code:"",description:""})},disabled:o,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),T?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading subjects..."})]}):e.jsx("div",{className:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(ge,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No subjects found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding a new subject."})]})}):(y&&Array.isArray(y)?y:[]).map(x=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(ge,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:x.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",x.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:x.code})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900",children:x.description||"No description provided"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>C(x),className:"text-blue-600 hover:text-blue-900",title:"Edit subject",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>z(x),className:"text-red-600 hover:text-red-900",title:"Delete subject",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},x.id))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Subject"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:x=>C({...p,name:x.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject Code *"}),e.jsx("input",{type:"text",value:p.code,onChange:x=>C({...p,code:x.target.value.toUpperCase()}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:p.description||"",onChange:x=>C({...p,description:x.target.value}),rows:3,className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>M(p.id,p),disabled:!p.name||!p.code||o,className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:o?"Updating...":"Update Subject"}),e.jsx("button",{onClick:()=>C(null),className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]})})}),e.jsx(oe,{isOpen:j.isOpen,onClose:S,onConfirm:_,title:"Delete Subject",message:"Are you sure you want to delete this subject? This action cannot be undone and will remove all associated data.",itemName:(I=j.subject)==null?void 0:I.name,isLoading:o})]})},Oe=()=>{const[y,E]=d.useState([]),[T,B]=d.useState([]),[R,O]=d.useState(!0),[p,C]=d.useState("all"),[j,A]=d.useState("all"),{showError:o}=ne();d.useEffect(()=>{N(),F()},[]);const N=async()=>{try{O(!0);const t=await v.getTeacherActivities({limit:50});let g=[];t!=null&&t.data?Array.isArray(t.data)?g=t.data:t.data.data&&Array.isArray(t.data.data)&&(g=t.data.data):Array.isArray(t)&&(g=t);const M=g.map(_=>{const z=new Date(_.created_at),S=z.toISOString().split("T")[0],I=z.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return{id:_.id,teacher_id:_.teacher_id,teacher:_.teacher||"Unknown Teacher",activity:_.activity,subject:_.subject||"General",class:_.class||"Unknown Class",date:S,time:I,status:_.status||"completed",description:_.description||"",created_at:_.created_at}});E(M.slice(0,20))}catch(t){console.error("Error fetching activities:",t),o("Failed to load teacher activities"),E([])}finally{O(!1)}},F=async()=>{try{const t=await v.getUsers();let g=[];t&&t.data&&(Array.isArray(t.data)?g=t.data:t.data.data&&Array.isArray(t.data.data)&&(g=t.data.data));const M=g.filter(_=>_.role==="teacher");B(M)}catch(t){console.error("Error fetching teachers:",t),B([])}},k=[{value:"all",label:"All Teachers"},...T.map(t=>({value:t.id,label:t.name}))],h=t=>({completed:"bg-green-100 text-green-800","in-progress":"bg-yellow-100 text-yellow-800",pending:"bg-gray-100 text-gray-800",overdue:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",f=t=>({"Result Entry":"","Score Entry":"","Attendance Marking":"","Student Addition":"","Assignment Grading":"","Parent Meeting":"","Lesson Planning":"","Exam Preparation":"","Student Assessment":""})[t]||"",b=y.filter(t=>{const g=p==="all"||t.teacher_id==p,M=j==="all"||t.status===j;return g&&M});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Teacher Activities"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("select",{value:p,onChange:t=>C(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:k.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsxs("select",{value:j,onChange:t=>A(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("span",{className:"text-green-600 text-lg",children:""})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completed"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.filter(t=>t.status==="completed").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("span",{className:"text-yellow-600 text-lg",children:""})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"In Progress"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.filter(t=>t.status==="in-progress").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx("span",{className:"text-gray-600 text-lg",children:""})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.filter(t=>t.status==="pending").length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("span",{className:"text-red-600 text-lg",children:""})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.filter(t=>t.status==="overdue").length})]})]})})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Recent Activities"})}),R?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading activities..."})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(t=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:f(t.activity)})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-900",children:t.activity}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${h(t.status)}`,children:t.status.replace("-"," ")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ce,{className:"w-3 h-3 mr-1"}),t.teacher]}),t.subject!=="General"&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(ge,{className:"w-3 h-3 mr-1"}),t.subject,"  ",t.class]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1",children:""}),t.date," at ",t.time]})]})]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-900 text-sm",children:"View Details"})})]})},t.id))}),!R&&b.length===0&&e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:""}),e.jsx("p",{className:"text-gray-500",children:"No activities found for the selected filters."})]})]})]})},Me=()=>{var L;const[y,E]=d.useState([]),[T,B]=d.useState(!0),[R,O]=d.useState(!1),[p,C]=d.useState(null),[j,A]=d.useState({isOpen:!1,admin:null}),[o,N]=d.useState(!1),{showSuccess:F,showError:k}=ne(),[h,f]=d.useState({name:"",email:"",username:"",password:"",role:"admin"}),b=[{value:"admin",label:"Administrator"}];d.useEffect(()=>{t()},[]);const t=async()=>{try{const l=await v.getUsers();H.component("Settings","fetchAdmins - Response received");let G=[];l&&l.data&&(Array.isArray(l.data)?G=l.data:l.data.data&&Array.isArray(l.data.data)&&(G=l.data.data)),H.component("Settings","fetchAdmins - Data loaded",{count:G.length});const r=G.filter(a=>a.role==="admin");E(r)}catch{k("Failed to fetch admins"),E([])}finally{B(!1)}},g=l=>{if(!l)return"";const r=l.toLowerCase().replace(/[^a-z\s]/g,"").trim().split(" ").filter(a=>a.length>0);return r.length>=2?`${r[0]}.${r[r.length-1]}.gloveacademy`:r.length===1?`${r[0]}.gloveacademy`:""},M=(l,G)=>{if(f(r=>({...r,[l]:G})),l==="name"){const r=g(G);f(a=>({...a,username:r}))}},_=async()=>{if(!h.name||!h.email||!h.username||!h.password){k("Please fill in all required fields");return}if(h.password.length<6){k("Password must be at least 6 characters long");return}if(!h.email.includes("@")){k("Please enter a valid email address");return}N(!0);try{const l={name:h.name,email:h.email,username:h.username,password:h.password,role:h.role,is_active:!0};await v.createUser(l),F("Admin added successfully"),f({name:"",email:"",username:"",password:"",role:"admin"}),O(!1),t()}catch(l){k(l.message||"Failed to add admin")}finally{N(!1)}},z=async(l,G)=>{N(!0);try{await v.updateUser(l,G),F("Admin updated successfully"),C(null),t()}catch(r){k(r.message||"Failed to update admin")}finally{N(!1)}},S=async()=>{if(j.admin){N(!0);try{await v.deleteUser(j.admin.id),F("Admin deleted successfully"),A({isOpen:!1,admin:null}),t()}catch(l){k(l.message||"Failed to delete admin")}finally{N(!1)}}},I=l=>{A({isOpen:!0,admin:l})},x=()=>{A({isOpen:!1,admin:null})},Y=l=>({principal:"bg-purple-100 text-purple-800",admin:"bg-blue-100 text-blue-800"})[l]||"bg-gray-100 text-gray-800",i=l=>({principal:"Principal",admin:"Administrator"})[l]||l;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Manage Administrators"}),e.jsxs("button",{onClick:()=>O(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:u.primary.red},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Add Administrator"]})]}),R&&e.jsxs("div",{className:"mb-6 p-6 border border-gray-200 rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Add New Administrator"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",value:h.name,onChange:l=>M("name",l.target.value),placeholder:"Enter full name",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:h.username,onChange:l=>M("username",l.target.value),placeholder:"Username (auto-generated from name)",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx("input",{type:"email",value:h.email,onChange:l=>M("email",l.target.value),placeholder:"admin@gloveacademy.edu.ng",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{value:h.role,onChange:l=>M("role",l.target.value),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"",children:"Select role"}),b.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password *"}),e.jsx("input",{type:"password",value:h.password,onChange:l=>M("password",l.target.value),placeholder:"Enter password (min 6 characters)",className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}}),h.password&&h.password.length<6&&e.jsx("p",{className:"text-sm text-yellow-600 mt-1",children:"Password must be at least 6 characters long"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:_,disabled:!h.name||!h.email||!h.username||!h.role||!h.password||o,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:o?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Administrator"]})}),e.jsx("button",{onClick:()=>{O(!1),f({name:"",email:"",username:"",password:"",role:"admin"})},disabled:o,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),T?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading administrators..."})]}):e.jsx("div",{className:"overflow-x-auto shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Administrator"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Username"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-500",children:[e.jsx(xe,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"No administrators found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Get started by adding a new administrator."})]})}):y.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(xe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:l.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",l.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:l.username})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:l.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${Y(l.role)}`,children:i(l.role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>C(l),className:"text-blue-600 hover:text-blue-900",title:"Edit administrator",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>I(l),className:"text-red-600 hover:text-red-900",title:"Delete administrator",children:e.jsx(re,{className:"h-4 w-4"})})]})})]},l.id))})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Administrator"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:l=>C({...p,name:l.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:p.username,onChange:l=>C({...p,username:l.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx("input",{type:"email",value:p.email,onChange:l=>C({...p,email:l.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsx("select",{value:p.role,onChange:l=>C({...p,role:l.target.value}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:b.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:p.is_active?"active":"inactive",onChange:l=>C({...p,is_active:l.target.value==="active"}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":u.primary.red},children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>z(p.id,{name:p.name,username:p.username,email:p.email,role:p.role,is_active:p.is_active}),disabled:!p.name||!p.username||!p.email||!p.role||o,className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:u.primary.red},children:o?"Updating...":"Update Administrator"}),e.jsx("button",{onClick:()=>C(null),className:"flex-1 inline-flex items-center justify-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"})]})]})})}),e.jsx(oe,{isOpen:j.isOpen,onClose:x,onConfirm:S,title:"Delete Administrator",message:"Are you sure you want to delete this administrator? This action cannot be undone and will remove all associated access.",itemName:(L=j.admin)==null?void 0:L.name,isLoading:o}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Administrators"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.length})]})]})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("span",{className:"text-blue-600 text-lg",children:""})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Administrators"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:y.filter(l=>l.is_active).length})]})]})})]})]})};export{Qe as default};
