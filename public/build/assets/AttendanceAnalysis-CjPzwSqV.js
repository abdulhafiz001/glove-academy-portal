import{u as J,r as n,A as b,d as f,j as e,C as h}from"./app-17JNjqSJ.js";import{A as E}from"./AdminLayout-DXkI0PI6.js";import{D as K}from"./download-7IDGFHuP.js";import{F as P}from"./funnel-Be2HiVOE.js";import{C as v}from"./calendar-BfCctGZ3.js";import{T as R}from"./trending-up-X4Mvz1sM.js";import{U as w}from"./users-BUbPeWYP.js";import{B as M}from"./book-open-D3qBa7nK.js";import"./file-text-Znh3F_nC.js";import"./user-CAmUnVMn.js";import"./log-out-Bc-nJCmd.js";import"./menu-BL5-W5Xp.js";const ie=()=>{var S,C,k,F,T;const{showError:p}=J(),[m,y]=n.useState(!0),[x,I]=n.useState(null),[d,W]=n.useState(null),[L,A]=n.useState([]),[D,O]=n.useState([]),[c,g]=n.useState(null),[i,j]=n.useState(null),[o,U]=n.useState(null),[u,B]=n.useState(null),[l,N]=n.useState(null),[q,Q]=n.useState(!1);n.useEffect(()=>{V(),$(),z()},[]),n.useEffect(()=>{c&&i&&!o&&!u&&_()},[c,i]);const V=async()=>{try{const s=await b.getCurrentAcademicSession();f.component("AttendanceAnalysis","fetchCurrentSession - Response received");let t=null,a=null;s!=null&&s.data?(t=s.data.session||s.data.academic_session,a=s.data.term):s!=null&&s.session?(t=s.session,a=s.term):s!=null&&s.academic_session&&(t=s.academic_session,a=s.term),t&&(I(t),g(t.id),f.component("AttendanceAnalysis","Session set",{sessionId:t.id})),a&&(W(a),j(a.name),f.component("AttendanceAnalysis","Term set",{term:a.name}))}catch{}finally{y(!1)}},$=async()=>{var s;try{const t=await b.getAcademicSessions();let a=[];Array.isArray(t)?a=t:t!=null&&t.data&&(Array.isArray(t.data)?a=t.data:(s=t.data)!=null&&s.data&&Array.isArray(t.data.data)&&(a=t.data.data)),A(a||[])}catch{A([])}},z=async()=>{var s;try{const t=await b.getClasses();let a=t==null?void 0:t.data;Array.isArray(t)?a=t:(s=t==null?void 0:t.data)!=null&&s.data&&Array.isArray(t.data.data)&&(a=t.data.data),O(a||[])}catch{}},_=async()=>{var s;if(!c||!i){N(null),p("Please select an academic session and term");return}y(!0);try{const t={academic_session_id:c,term:i};o&&(t.class_id=o),u&&(t.week=u),f.component("AttendanceAnalysis","Fetching statistics",{params:t});const a=await b.getAttendanceStatistics(t);let r=null;(s=a==null?void 0:a.data)!=null&&s.data?r=a.data.data:a!=null&&a.data&&a.data.overall?r=a.data:a!=null&&a.overall?r=a:a!=null&&a.data&&(r=a.data),f.component("AttendanceAnalysis","Statistics processed"),(!r||!r.overall)&&(r={overall:{total_records:0,total_present:0,total_absent:0,unique_students:0,average_attendance_rate:0},by_student:(r==null?void 0:r.by_student)||[],by_class:(r==null?void 0:r.by_class)||[]}),f.component("AttendanceAnalysis","Statistics set"),N(r)}catch{p("Error loading attendance statistics"),N(null)}finally{y(!1)}},G=async()=>{p("Export feature coming soon")},H=Array.from({length:14},(s,t)=>t+1);return m&&!l?e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:h.primary.red}})})}):e.jsx(E,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:h.primary.red},children:"Attendance Analysis"}),x&&d&&e.jsxs("p",{className:"text-gray-600",children:["Current Session: ",e.jsx("span",{className:"font-semibold",children:x.name})," | Current Term: ",e.jsx("span",{className:"font-semibold",children:d.name})]})]}),e.jsxs("button",{onClick:G,disabled:q,className:"flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Export"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(P,{className:"mr-2 h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Filters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Academic Session"}),e.jsxs("select",{value:c||"",onChange:s=>{s.target.value===""?(g((x==null?void 0:x.id)||null),j((d==null?void 0:d.name)||null)):(g(parseInt(s.target.value)),i||j((d==null?void 0:d.name)||null))},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"Current Session"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Term"}),e.jsxs("select",{value:i||"",onChange:s=>{const t=s.target.value||null;j(t)},disabled:!c,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 disabled:bg-gray-100",children:[e.jsx("option",{value:"",children:"Select Term"}),e.jsx("option",{value:"first",children:"First Term"}),e.jsx("option",{value:"second",children:"Second Term"}),e.jsx("option",{value:"third",children:"Third Term"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class"}),e.jsxs("select",{value:o||"",onChange:s=>U(s.target.value?parseInt(s.target.value):null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Classes"}),D.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Week"}),e.jsxs("select",{value:u||"",onChange:s=>B(s.target.value?parseInt(s.target.value):null),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"",children:"All Weeks"}),H.map(s=>e.jsxs("option",{value:s,children:["Week ",s]},s))]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:s=>{if(s.preventDefault(),f.component("AttendanceAnalysis","Apply Filters clicked",{selectedSession:c,selectedTerm:i,selectedClass:o,selectedWeek:u,loading:m,currentSession:x==null?void 0:x.id,currentTerm:d==null?void 0:d.name}),!c){p("Please select an academic session");return}if(!i||i===""){p("Please select a term");return}_()},disabled:m,className:"px-6 py-2 text-white rounded-lg font-semibold hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center",style:{backgroundColor:h.primary.red},children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),m?"Loading...":"Apply Filters"]})})]}),m&&!l&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:h.primary.red}})}),!m&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold",style:{color:h.primary.red},children:((S=l.overall)==null?void 0:S.total_records)||0})]}),e.jsx(v,{className:"h-8 w-8 text-gray-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Present"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:((C=l.overall)==null?void 0:C.total_present)||0})]}),e.jsx(R,{className:"h-8 w-8 text-green-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Absent"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:((k=l.overall)==null?void 0:k.total_absent)||0})]}),e.jsx(w,{className:"h-8 w-8 text-red-400"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Attendance Rate"}),e.jsxs("p",{className:"text-2xl font-bold",style:{color:h.primary.red},children:[((T=(F=l.overall)==null?void 0:F.average_attendance_rate)==null?void 0:T.toFixed(1))||0,"%"]})]}),e.jsx(R,{className:"h-8 w-8",style:{color:h.primary.red}})]})})]}),l.by_class&&l.by_class.length>0&&!o&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(M,{className:"mr-2 h-5 w-5"}),"Class-wise Statistics"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Class"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Total Records"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Present"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Students"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Attendance Rate"})]})}),e.jsx("tbody",{children:l.by_class.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 font-medium",children:s.class_name}),e.jsx("td",{className:"text-center py-3 px-4",children:s.total_records}),e.jsx("td",{className:"text-center py-3 px-4 text-green-600 font-semibold",children:s.total_present}),e.jsx("td",{className:"text-center py-3 px-4",children:s.total_students}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsxs("span",{className:"font-semibold",style:{color:h.primary.red},children:[s.average_attendance_rate.toFixed(1),"%"]})})]},t))})]})})]}),l.by_student&&l.by_student.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx(w,{className:"mr-2 h-5 w-5"}),"Student-wise Statistics"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"S/N"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Student Name"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",children:"Admission No."}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Total"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Present"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Absent"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold",children:"Attendance Rate"})]})}),e.jsx("tbody",{children:l.by_student.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:t+1}),e.jsx("td",{className:"py-3 px-4 font-medium",children:s.student_name}),e.jsx("td",{className:"py-3 px-4 text-gray-600",children:s.admission_number}),e.jsx("td",{className:"text-center py-3 px-4",children:s.total}),e.jsx("td",{className:"text-center py-3 px-4 text-green-600 font-semibold",children:s.present}),e.jsx("td",{className:"text-center py-3 px-4 text-red-600 font-semibold",children:s.absent}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsxs("span",{className:`font-semibold ${s.attendance_rate>=80?"text-green-600":s.attendance_rate>=60?"text-yellow-600":"text-red-600"}`,children:[s.attendance_rate.toFixed(1),"%"]})})]},s.student_id))})]})})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 font-medium",children:o?"No student attendance data found for the selected class and week.":"No student attendance data available."}),o&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Attendance may not have been marked for this class, subject, or week yet."})]})})]}),!m&&!l&&c&&i&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(v,{className:"h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Attendance Data Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:o?"No attendance records found for the selected filters.":"No attendance records found for this session and term."}),o&&e.jsx("p",{className:"text-sm text-gray-500",children:"Try selecting a different class, week, or check if attendance has been marked for this period."})]})}),!m&&!c&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(v,{className:"h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Select Filters"}),e.jsx("p",{className:"text-gray-600",children:"Please select an academic session and term to view attendance analysis."})]})})]})})})};export{ie as default};
