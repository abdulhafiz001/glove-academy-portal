import{c as T,r as d,u as P,a as $,A as v,j as e,x as B,C as w,d as y}from"./app-17JNjqSJ.js";import{A as G,U as q}from"./AdminLayout-DXkI0PI6.js";import{S as k}from"./shield-Dhn-V6E4.js";import{B as p}from"./book-open-D3qBa7nK.js";import{U as b}from"./users-BUbPeWYP.js";import{G as V}from"./graduation-cap-mrkAgQ1z.js";import{S as W}from"./search-Dk6ZNiIw.js";import"./file-text-Znh3F_nC.js";import"./calendar-BfCctGZ3.js";import"./user-CAmUnVMn.js";import"./log-out-Bc-nJCmd.js";import"./menu-BL5-W5Xp.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],K=T("chevron-down",H);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],X=T("chevron-up",Q),ve=({classes:m=[],total:Z=0})=>{const[h,L]=d.useState(""),[S,E]=d.useState({}),[u,U]=d.useState("all"),[x,f]=d.useState(()=>Array.isArray(m)?m:[]),[F,c]=d.useState(!1),[I,J]=d.useState([]),{showError:g,showSuccess:ee}=P(),{user:t,getCurrentUserWithFreshStatus:M}=$(),[se,te]=d.useState(null),[ae,re]=d.useState(!1),[le,ne]=d.useState(!1),[ie,de]=d.useState(null),o=d.useRef(!1);d.useEffect(()=>{if(m!==void 0&&!o.current){f(Array.isArray(m)?m:[]),c(!1),o.current=!0,(t==null?void 0:t.role)==="admin"&&C();return}(async()=>{if(t!=null&&t.id&&!o.current){o.current=!0,c(!0);try{const a=await M(),r=(a==null?void 0:a.role)||(t==null?void 0:t.role),n=(a==null?void 0:a.is_form_teacher)||(t==null?void 0:t.is_form_teacher);r==="admin"||n?await O(r,n):c(!1),r==="admin"&&await C()}catch{o.current=!1,c(!1)}}else if(!(t!=null&&t.id)&&!o.current){const a=setTimeout(()=>{t!=null&&t.id||c(!1)},2e3);return()=>clearTimeout(a)}})()},[t==null?void 0:t.id,m]);const O=async(s=null,a=null)=>{var r;try{c(!0);const n=s||(t==null?void 0:t.role),j=a!==null?a:t==null?void 0:t.is_form_teacher;y.component("Classes","fetchClasses",{userRole:n,isFormTeacher:j});let l;if(n==="admin")l=await v.getClasses();else if(n==="teacher")if(j)l=await v.getTeacherAdminClasses();else{g("Access denied. Only form teachers can view classes."),f([]),c(!1);return}else{g("Access denied. You do not have permission to view classes."),f([]),c(!1);return}let i=[];if((t==null?void 0:t.role)==="teacher")i=l.data||l,i=Array.isArray(i)?i:[];else{if(l!=null&&l.data){if(l.data.data&&Array.isArray(l.data.data))i=l.data.data;else if(Array.isArray(l.data))i=l.data;else if(typeof l.data=="object"){const z=Object.keys(l.data);for(const _ of z)if(Array.isArray(l.data[_])){i=l.data[_];break}}}else Array.isArray(l)&&(i=l);Array.isArray(i)||(y.warn("Unexpected admin response structure:",l),i=[])}Array.isArray(i)||(y.error("Classes data is not an array after processing:",i),i=[]),y.component("Classes","fetchClasses - Data loaded",{count:(i==null?void 0:i.length)||0,isArray:Array.isArray(i)}),f(i)}catch(n){((r=n.response)==null?void 0:r.status)===403?(g("Access denied. You do not have permission to view classes."),f([])):g("Failed to load classes")}finally{c(!1)}},C=async()=>{try{const a=(await v.getUsers()).data.filter(r=>r.role==="teacher");J(a)}catch{}},D=s=>{E(a=>({...a,[s]:!a[s]}))},R=s=>({jss:"bg-green-100 text-green-800",ss:"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",N=s=>s.includes("JSS")?"jss":s.includes("SS")?"ss":"other",A=d.useMemo(()=>{let s=x;return u!=="all"&&(u==="jss"?s=s.filter(a=>a.name.includes("JSS")):u==="ss"&&(s=s.filter(a=>a.name.includes("SS")))),h&&(s=s.filter(a=>{var r;return a.name.toLowerCase().includes(h.toLowerCase())||((r=a.form_teacher)==null?void 0:r.name)&&a.form_teacher.name.toLowerCase().includes(h.toLowerCase())})),s},[x,u,h]);if(F&&!o.current)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"})});if((t==null?void 0:t.role)==="teacher"&&!(t!=null&&t.is_form_teacher))return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Access Denied"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Only form teachers can access the classes page. Please contact the administrator if you believe this is an error."})]});const Y=x.reduce((s,a)=>{var n;const r=a.student_count||((n=a.students)==null?void 0:n.length)||0;return s+(Number.isNaN(r)?0:Number(r))},0);return e.jsx(G,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold leading-7 text-gray-900 sm:text-3xl",children:"Classes Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:(t==null?void 0:t.role)==="admin"?"Manage all classes from Primary 1 to SS 3 and their students.":"View classes where you are assigned as the form teacher."})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx(B,{to:"/admin/settings",children:e.jsxs("button",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white shadow-sm hover:shadow-lg transition-all",style:{backgroundColor:w.primary.red},children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Add Class"]})})})]}),(t==null?void 0:t.role)==="teacher"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(k,{className:"h-5 w-5 text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Form Teacher Access"}),e.jsx("div",{className:"mt-2 text-sm text-blue-700",children:e.jsx("p",{children:"You can only view classes where you are assigned as the form teacher."})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(p,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Classes"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:x.length})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(b,{className:"h-6 w-6 text-gray-400"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Students"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:Y})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-6 w-6 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(V,{className:"h-4 w-4 text-green-600"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Junior Secondary"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:x.filter(s=>{var r;const a=((r=s.name)==null?void 0:r.toUpperCase())||"";return a.includes("JSS")&&!a.includes("SS")}).length})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-6 w-6 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(p,{className:"h-4 w-4 text-purple-600"})})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Senior Secondary"}),e.jsx("dd",{className:"text-lg font-medium text-gray-900",children:x.filter(s=>{var r;const a=((r=s.name)==null?void 0:r.toUpperCase())||"";return a.includes("SS")&&!a.includes("JSS")}).length})]})})]})})})]}),e.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search classes or teachers...",value:h,onChange:s=>L(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":w.primary.red}})]})}),e.jsx("div",{className:"flex space-x-3",children:e.jsxs("select",{value:u,onChange:s=>U(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":w.primary.red},children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"jss",children:"Junior Secondary (JSS)"}),e.jsx("option",{value:"ss",children:"Senior Secondary (SS)"})]})})]})}),e.jsx("div",{className:"space-y-4",children:A.map(s=>{var a,r;return e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-6 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>D(s.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-gray-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Class Teacher: ",(a=s.form_teacher)==null?void 0:a.name]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${R(N(s.name))}`,children:N(s.name).charAt(0).toUpperCase()+N(s.name).slice(1)}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:s.student_count||((r=s.students)==null?void 0:r.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:"Students"})]}),S[s.id]?e.jsx(X,{className:"h-5 w-5 text-gray-400"}):e.jsx(K,{className:"h-5 w-5 text-gray-400"})]})]})}),S[s.id]&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 p-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-4",children:["Students in ",s.name]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[s.students&&s.students.length>0?s.students.map(n=>e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"text-sm font-medium text-gray-900",children:[n.first_name," ",n.last_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:n.admission_number}),e.jsx("p",{className:"text-xs text-gray-500",children:n.date_of_birth?`${new Date().getFullYear()-new Date(n.date_of_birth).getFullYear()} years`:"Age not specified"})]})]})},n.id)):e.jsxs("div",{className:"col-span-full text-center py-8",children:[e.jsx(b,{className:"mx-auto h-8 w-8 text-gray-400"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"No students in this class"})]}),s.students&&(()=>{const n=s.student_count||s.students.length||0,j=s.students.length||0,l=Number(n)-Number(j);return l>0&&e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg border border-gray-200 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm text-gray-500",children:["+",l," more students"]})})})()]})]})]},s.id)})}),A.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No classes found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search or filter criteria."})]})]})})};export{ve as default};
